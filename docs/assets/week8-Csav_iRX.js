var fr=Object.defineProperty;var me=o=>{throw TypeError(o)};var cr=(o,r,e)=>r in o?fr(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e;var pe=(o,r,e)=>cr(o,typeof r!="symbol"?r+"":r,e),Kt=(o,r,e)=>r.has(o)||me("Cannot "+e);var ut=(o,r,e)=>(Kt(o,r,"read from private field"),e?e.call(o):r.get(o)),Xt=(o,r,e)=>r.has(o)?me("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(o):r.set(o,e),Nt=(o,r,e,t)=>(Kt(o,r,"write to private field"),t?t.call(o,e):r.set(o,e),e),Yt=(o,r,e)=>(Kt(o,r,"access private method"),e);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{l as gr,a as we}from"./library-BPfaNgXk.js";const mr=o=>({type:"embedding",data:{version:"71addf5a5e7c400e091f33ef8ae1c40d72a25966897d05ebe36a7edb06a86a2c",input:{inputs:o}}}),pr="https://replicate-api-proxy.glitch.me/create_n_get/",wr=async o=>{try{return await vr(mr(o))}catch{alert("fetch embedding failed")}},vr=async o=>{const r={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o.data)};try{console.log("Start fetching");const t=await(await fetch(pr,r)).json();if(o.type==="text")return dr(t);if(o.type==="embedding")return t;throw new Error}catch(e){console.log(e)}},dr=o=>o.output.join("").match(/\+([^+]+)\+/)[1].trim();var k=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function qt(o){if(o.__esModule)return o;var r=o.default;if(typeof r=="function"){var e=function t(){return this instanceof t?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};e.prototype=r.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(o).forEach(function(t){var n=Object.getOwnPropertyDescriptor(o,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return o[t]}})}),e}var Ie={},J={},X={},C={},br=k&&k.__values||function(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],t=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&t>=o.length&&(o=void 0),{value:o&&o[t++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(C,"__esModule",{value:!0});C.reshape2d=C.rejectionSample=C.max2d=C.max=C.mean=C.sum=C.linear=C.ones=C.zeros=C.filled=C.range=C.empty=C.norm=C.tauRand=C.tauRandInt=void 0;function Te(o,r){return Math.floor(r()*o)}C.tauRandInt=Te;function Sr(o){return o()}C.tauRand=Sr;function Mr(o){var r,e,t=0;try{for(var n=br(o),s=n.next();!s.done;s=n.next()){var i=s.value;t+=Math.pow(i,2)}}catch(u){r={error:u}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(r)throw r.error}}return Math.sqrt(t)}C.norm=Mr;function Lt(o){for(var r=[],e=0;e<o;e++)r.push(void 0);return r}C.empty=Lt;function Er(o){return Lt(o).map(function(r,e){return e})}C.range=Er;function oe(o,r){return Lt(o).map(function(){return r})}C.filled=oe;function Pe(o){return oe(o,0)}C.zeros=Pe;function jr(o){return oe(o,1)}C.ones=jr;function xr(o,r,e){return Lt(e).map(function(t,n){return o+n*((r-o)/(e-1))})}C.linear=xr;function Oe(o){return o.reduce(function(r,e){return r+e})}C.sum=Oe;function _r(o){return Oe(o)/o.length}C.mean=_r;function Rr(o){for(var r=0,e=0;e<o.length;e++)r=o[e]>r?o[e]:r;return r}C.max=Rr;function Nr(o){for(var r=0,e=0;e<o.length;e++)for(var t=0;t<o[e].length;t++)r=o[e][t]>r?o[e][t]:r;return r}C.max2d=Nr;function kr(o,r,e){for(var t=Pe(o),n=0;n<o;n++)for(var s=!0;s;){for(var i=Te(r,e),u=!1,l=0;l<n;l++)if(i===t[l]){u=!0;break}u||(s=!1),t[n]=i}return t}C.rejectionSample=kr;function zr(o,r,e){var t=[],n=0;if(o.length!==r*e)throw new Error("Array dimensions must match input length.");for(var s=0;s<r;s++){for(var i=[],u=0;u<e;u++)i.push(o[n]),n+=1;t.push(i)}return t}C.reshape2d=zr;var Ir=k&&k.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),Tr=k&&k.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),Pr=k&&k.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&Ir(r,o,e);return Tr(r,o),r};Object.defineProperty(X,"__esModule",{value:!0});X.smallestFlagged=X.deheapSort=X.buildCandidates=X.uncheckedHeapPush=X.heapPush=X.rejectionSample=X.makeHeap=void 0;var xt=Pr(C);function $e(o,r){var e=function(n){return xt.empty(o).map(function(){return xt.filled(r,n)})},t=[];return t.push(e(-1)),t.push(e(1/0)),t.push(e(0)),t}X.makeHeap=$e;function Or(o,r,e){for(var t=xt.zeros(o),n=0;n<o;n++){for(var s=!0,i=0;s;){i=xt.tauRandInt(r,e);for(var u=!1,l=0;l<n;l++)if(i===t[l]){u=!0;break}u||(s=!1)}t[n]=i}return t}X.rejectionSample=Or;function Jt(o,r,e,t,n){r=Math.floor(r);var s=o[0][r],i=o[1][r];if(o[2][r],e>=i[0])return 0;for(var u=0;u<s.length;u++)if(t===s[u])return 0;return Fe(o,r,e,t,n)}X.heapPush=Jt;function Fe(o,r,e,t,n){var s=o[0][r],i=o[1][r],u=o[2][r];if(e>=i[0])return 0;i[0]=e,s[0]=t,u[0]=n;for(var l=0,a=0;;){var f=2*l+1,h=f+1,c=o[0][0].length;if(f>=c)break;if(h>=c)if(i[f]>e)a=f;else break;else if(i[f]>=i[h])if(e<i[f])a=f;else break;else if(e<i[h])a=h;else break;i[l]=i[a],s[l]=s[a],u[l]=u[a],l=a}return i[l]=e,s[l]=t,u[l]=n,1}X.uncheckedHeapPush=Fe;function $r(o,r,e,t,n){for(var s=$e(r,t),i=0;i<r;i++)for(var u=0;u<e;u++)if(!(o[0][i][u]<0)){var l=o[0][i][u],a=o[2][i][u],f=xt.tauRand(n);Jt(s,i,f,l,a),Jt(s,l,f,i,a),o[2][i][u]=0}return s}X.buildCandidates=$r;function Fr(o){for(var r=o[0],e=o[1],t=0;t<r.length;t++)for(var n=r[t],s=e[t],i=0;i<n.length-1;i++){var u=n.length-i-1,l=s.length-i-1,a=n[0];n[0]=n[u],n[u]=a;var f=s[0];s[0]=s[l],s[l]=f,Dr(s,n,l,0)}return{indices:r,weights:e}}X.deheapSort=Fr;function Dr(o,r,e,t){for(;t*2+1<e;){var n=t*2+1,s=n+1,i=t;if(o[i]<o[n]&&(i=n),s<e&&o[i]<o[s]&&(i=s),i===t)break;var u=o[t];o[t]=o[i],o[i]=u;var l=r[t];r[t]=r[i],r[i]=l,t=i}}function Cr(o,r){for(var e=o[0][r],t=o[1][r],n=o[2][r],s=1/0,i=-1,u=0;u>e.length;u++)n[u]===1&&t[u]<s&&(s=t[u],i=u);return i>=0?(n[i]=0,Math.floor(e[i])):-1}X.smallestFlagged=Cr;var L={},qr=k&&k.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),Lr=k&&k.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),Vr=k&&k.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&qr(r,o,e);return Lr(r,o),r},Ot=k&&k.__read||function(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var t=e.call(o),n,s=[],i;try{for(;(r===void 0||r-- >0)&&!(n=t.next()).done;)s.push(n.value)}catch(u){i={error:u}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(i)throw i.error}}return s},Br=k&&k.__values||function(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],t=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&t>=o.length&&(o=void 0),{value:o&&o[t++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Et;Object.defineProperty(L,"__esModule",{value:!0});L.getCSR=L.normalize=L.eliminateZeros=L.multiplyScalar=L.maximum=L.subtract=L.add=L.pairwiseMultiply=L.identity=L.transpose=L.SparseMatrix=void 0;var ve=Vr(C),St=function(){function o(r,e,t,n){if(this.entries=new Map,this.nRows=0,this.nCols=0,r.length!==e.length||r.length!==t.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=n[0],this.nCols=n[1];for(var s=0;s<t.length;s++){var i=r[s],u=e[s];this.checkDims(i,u);var l=this.makeKey(i,u);this.entries.set(l,{value:t[s],row:i,col:u})}}return o.prototype.makeKey=function(r,e){return r+":"+e},o.prototype.checkDims=function(r,e){var t=r<this.nRows&&e<this.nCols;if(!t)throw new Error("row and/or col specified outside of matrix dimensions")},o.prototype.set=function(r,e,t){this.checkDims(r,e);var n=this.makeKey(r,e);this.entries.has(n)?this.entries.get(n).value=t:this.entries.set(n,{value:t,row:r,col:e})},o.prototype.get=function(r,e,t){t===void 0&&(t=0),this.checkDims(r,e);var n=this.makeKey(r,e);return this.entries.has(n)?this.entries.get(n).value:t},o.prototype.getAll=function(r){r===void 0&&(r=!0);var e=[];return this.entries.forEach(function(t){e.push(t)}),r&&e.sort(function(t,n){return t.row===n.row?t.col-n.col:t.row-n.row}),e},o.prototype.getDims=function(){return[this.nRows,this.nCols]},o.prototype.getRows=function(){return Array.from(this.entries,function(r){var e=Ot(r,2);e[0];var t=e[1];return t.row})},o.prototype.getCols=function(){return Array.from(this.entries,function(r){var e=Ot(r,2);e[0];var t=e[1];return t.col})},o.prototype.getValues=function(){return Array.from(this.entries,function(r){var e=Ot(r,2);e[0];var t=e[1];return t.value})},o.prototype.forEach=function(r){this.entries.forEach(function(e){return r(e.value,e.row,e.col)})},o.prototype.map=function(r){var e=[];this.entries.forEach(function(n){e.push(r(n.value,n.row,n.col))});var t=[this.nRows,this.nCols];return new o(this.getRows(),this.getCols(),e,t)},o.prototype.toArray=function(){var r=this,e=ve.empty(this.nRows),t=e.map(function(){return ve.zeros(r.nCols)});return this.entries.forEach(function(n){t[n.row][n.col]=n.value}),t},o}();L.SparseMatrix=St;function Ur(o){var r=[],e=[],t=[];o.forEach(function(s,i,u){r.push(i),e.push(u),t.push(s)});var n=[o.nCols,o.nRows];return new St(e,r,t,n)}L.transpose=Ur;function Wr(o){for(var r=Ot(o,1),e=r[0],t=new St([],[],[],o),n=0;n<e;n++)t.set(n,n,1);return t}L.identity=Wr;function Gr(o,r){return Vt(o,r,function(e,t){return e*t})}L.pairwiseMultiply=Gr;function Kr(o,r){return Vt(o,r,function(e,t){return e+t})}L.add=Kr;function Xr(o,r){return Vt(o,r,function(e,t){return e-t})}L.subtract=Xr;function Yr(o,r){return Vt(o,r,function(e,t){return e>t?e:t})}L.maximum=Yr;function Qr(o,r){return o.map(function(e){return e*r})}L.multiplyScalar=Qr;function Jr(o){for(var r=new Set,e=o.getValues(),t=o.getRows(),n=o.getCols(),s=0;s<e.length;s++)e[s]===0&&r.add(s);var i=function(f,h){return!r.has(h)},u=e.filter(i),l=t.filter(i),a=n.filter(i);return new St(l,a,u,o.getDims())}L.eliminateZeros=Jr;function Zr(o,r){var e,t;r===void 0&&(r="l2");var n=Ar[r],s=new Map;o.forEach(function(h,c,p){var m=s.get(c)||[];m.push(p),s.set(c,m)});var i=new St([],[],[],o.getDims()),u=function(h){for(var c=s.get(h).sort(),p=c.map(function(y){return o.get(h,y)}),m=n(p),v=0;v<m.length;v++)i.set(h,c[v],m[v])};try{for(var l=Br(s.keys()),a=l.next();!a.done;a=l.next()){var f=a.value;u(f)}}catch(h){e={error:h}}finally{try{a&&!a.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}return i}L.normalize=Zr;var Ar=(Et={},Et.max=function(o){for(var r=-1/0,e=0;e<o.length;e++)r=o[e]>r?o[e]:r;return o.map(function(t){return t/r})},Et.l1=function(o){for(var r=0,e=0;e<o.length;e++)r+=o[e];return o.map(function(t){return t/r})},Et.l2=function(o){for(var r=0,e=0;e<o.length;e++)r+=Math.pow(o[e],2);return o.map(function(t){return Math.sqrt(Math.pow(t,2)/r)})},Et);function Vt(o,r,e){for(var t=new Set,n=[],s=[],i=[],u=function(M,x){n.push(M),s.push(x);var E=e(o.get(M,x),r.get(M,x));i.push(E)},l=o.getValues(),a=o.getRows(),f=o.getCols(),h=0;h<l.length;h++){var c=a[h],p=f[h],m=c+":"+p;t.add(m),u(c,p)}for(var v=r.getValues(),y=r.getRows(),g=r.getCols(),h=0;h<v.length;h++){var c=y[h],p=g[h],m=c+":"+p;t.has(m)||u(c,p)}var b=[o.nRows,o.nCols];return new St(n,s,i,b)}function Hr(o){var r=[];o.forEach(function(h,c,p){r.push({value:h,row:c,col:p})}),r.sort(function(h,c){return h.row===c.row?h.col-c.col:h.row-c.row});for(var e=[],t=[],n=[],s=-1,i=0;i<r.length;i++){var u=r[i],l=u.row,a=u.col,f=u.value;l!==s&&(s=l,n.push(i)),e.push(a),t.push(f)}return{indices:e,values:t,indptr:n}}L.getCSR=Hr;var ft={},at={},tn=k&&k.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),en=k&&k.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),rn=k&&k.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&tn(r,o,e);return en(r,o),r},nn=k&&k.__read||function(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var t=e.call(o),n,s=[],i;try{for(;(r===void 0||r-- >0)&&!(n=t.next()).done;)s.push(n.value)}catch(u){i={error:u}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(i)throw i.error}}return s},De=k&&k.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(nn(arguments[r]));return o},on=k&&k.__values||function(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],t=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&t>=o.length&&(o=void 0),{value:o&&o[t++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(at,"__esModule",{value:!0});at.searchFlatTree=at.makeLeafArray=at.makeForest=at.FlatTree=void 0;var Z=rn(C),Ce=function(){function o(r,e,t,n){this.hyperplanes=r,this.offsets=e,this.children=t,this.indices=n}return o}();at.FlatTree=Ce;function sn(o,r,e,t){var n=Math.max(10,r),s=Z.range(e).map(function(u,l){return ln(o,n,l,t)}),i=s.map(function(u){return an(u,n)});return i}at.makeForest=sn;function ln(o,r,e,t){r===void 0&&(r=30);var n=Z.range(o.length),s=Zt(o,n,r,e,t);return s}function Zt(o,r,e,t,n){if(e===void 0&&(e=30),r.length>e){var s=un(o,r,n),i=s.indicesLeft,u=s.indicesRight,l=s.hyperplane,a=s.offset,f=Zt(o,i,e,t+1,n),h=Zt(o,u,e,t+1,n),c={leftChild:f,rightChild:h,isLeaf:!1,hyperplane:l,offset:a};return c}else{var c={indices:r,isLeaf:!0};return c}}function un(o,r,e){var t=o[0].length,n=Z.tauRandInt(r.length,e),s=Z.tauRandInt(r.length,e);s+=n===s?1:0,s=s%r.length;for(var i=r[n],u=r[s],l=0,a=Z.zeros(t),f=0;f<a.length;f++)a[f]=o[i][f]-o[u][f],l-=a[f]*(o[i][f]+o[u][f])/2;for(var h=0,c=0,p=Z.zeros(r.length),f=0;f<r.length;f++){for(var m=l,v=0;v<t;v++)m+=a[v]*o[r[f]][v];m===0?(p[f]=Z.tauRandInt(2,e),p[f]===0?h+=1:c+=1):m>0?(p[f]=0,h+=1):(p[f]=1,c+=1)}var y=Z.zeros(h),g=Z.zeros(c);h=0,c=0;for(var f=0;f<p.length;f++)p[f]===0?(y[h]=r[f],h+=1):(g[c]=r[f],c+=1);return{indicesLeft:y,indicesRight:g,hyperplane:a,offset:l}}function an(o,r){var e=Ht(o),t=te(o),n=Z.range(e).map(function(){return Z.zeros(o.hyperplane?o.hyperplane.length:0)}),s=Z.zeros(e),i=Z.range(e).map(function(){return[-1,-1]}),u=Z.range(t).map(function(){return Z.range(r).map(function(){return-1})});return At(o,n,s,i,u,0,0),new Ce(n,s,i,u)}function At(o,r,e,t,n,s,i){var u;if(o.isLeaf)return t[s][0]=-i,(u=n[i]).splice.apply(u,De([0,o.indices.length],o.indices)),i+=1,{nodeNum:s,leafNum:i};r[s]=o.hyperplane,e[s]=o.offset,t[s][0]=s+1;var l=s,a=At(o.leftChild,r,e,t,n,s+1,i);return s=a.nodeNum,i=a.leafNum,t[l][1]=s+1,a=At(o.rightChild,r,e,t,n,s+1,i),{nodeNum:a.nodeNum,leafNum:a.leafNum}}function Ht(o){return o.isLeaf?1:1+Ht(o.leftChild)+Ht(o.rightChild)}function te(o){return o.isLeaf?1:te(o.leftChild)+te(o.rightChild)}function hn(o){var r,e;if(o.length>0){var t=[];try{for(var n=on(o),s=n.next();!s.done;s=n.next()){var i=s.value;t.push.apply(t,De(i.indices))}}catch(u){r={error:u}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(r)throw r.error}}return t}else return[[-1]]}at.makeLeafArray=hn;function fn(o,r,e,t){for(var n=r,s=0;s<e.length;s++)n+=o[s]*e[s];if(n===0){var i=Z.tauRandInt(2,t);return i}else return n>0?0:1}function cn(o,r,e){for(var t=0;r.children[t][0]>0;){var n=fn(r.hyperplanes[t],r.offsets[t],o,e);n===0?t=r.children[t][0]:t=r.children[t][1]}var s=-1*r.children[t][0];return r.indices[s]}at.searchFlatTree=cn;var gn=k&&k.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),mn=k&&k.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),Bt=k&&k.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&gn(r,o,e);return mn(r,o),r},qe=k&&k.__values||function(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],t=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&t>=o.length&&(o=void 0),{value:o&&o[t++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(ft,"__esModule",{value:!0});ft.initializeSearch=ft.makeInitializedNNSearch=ft.makeInitializations=ft.makeNNDescent=void 0;var A=Bt(X),pn=Bt(L),wn=Bt(at),Le=Bt(C);function vn(o,r){return function(t,n,s,i,u,l,a,f){i===void 0&&(i=10),u===void 0&&(u=50),l===void 0&&(l=.001),a===void 0&&(a=.5),f===void 0&&(f=!0);for(var h=t.length,c=A.makeHeap(t.length,s),p=0;p<t.length;p++)for(var m=A.rejectionSample(s,t.length,r),v=0;v<m.length;v++){var y=o(t[p],t[m[v]]);A.heapPush(c,p,y,m[v],1),A.heapPush(c,m[v],y,p,1)}if(f)for(var g=0;g<n.length;g++)for(var p=0;p<n[g].length&&!(n[g][p]<0);p++)for(var v=p+1;v<n[g].length&&!(n[g][v]<0);v++){var y=o(t[n[g][p]],t[n[g][v]]);A.heapPush(c,n[g][p],y,n[g][v],1),A.heapPush(c,n[g][v],y,n[g][p],1)}for(var g=0;g<i;g++){for(var b=A.buildCandidates(c,h,s,u,r),M=0,p=0;p<h;p++)for(var v=0;v<u;v++){var x=Math.floor(b[0][p][v]);if(!(x<0||Le.tauRand(r)<a))for(var E=0;E<u;E++){var z=Math.floor(b[0][p][E]),_=b[2][p][v],R=b[2][p][E];if(!(z<0||!_&&!R)){var y=o(t[x],t[z]);M+=A.heapPush(c,x,y,z,1),M+=A.heapPush(c,z,y,x,1)}}}if(M<=l*s*t.length)break}var I=A.deheapSort(c);return I}}ft.makeNNDescent=vn;function dn(o){function r(t,n,s,i,u){for(var l=0;l<s.length;l++)for(var a=Le.rejectionSample(t,n.length,u),f=0;f<a.length;f++)if(!(a[f]<0)){var h=o(n[a[f]],s[l]);A.heapPush(i,l,h,a[f],1)}}function e(t,n,s,i,u){for(var l=0;l<s.length;l++)for(var a=wn.searchFlatTree(s[l],t,u),f=0;f<a.length;f++){if(a[f]<0)return;var h=o(n[a[f]],s[l]);A.heapPush(i,l,h,a[f],1)}}return{initFromRandom:r,initFromTree:e}}ft.makeInitializations=dn;function yn(o){return function(e,t,n,s){for(var i,u,l=pn.getCSR(t),a=l.indices,f=l.indptr,h=0;h<s.length;h++)for(var c=new Set(n[0][h]);;){var p=A.smallestFlagged(n,h);if(p===-1)break;var m=a.slice(f[p],f[p+1]);try{for(var v=(i=void 0,qe(m)),y=v.next();!y.done;y=v.next()){var g=y.value;if(!(g===p||g===-1||c.has(g))){var b=o(e[g],s[h]);A.uncheckedHeapPush(n,h,b,g,1),c.add(g)}}}catch(M){i={error:M}}finally{try{y&&!y.done&&(u=v.return)&&u.call(v)}finally{if(i)throw i.error}}}return n}}ft.makeInitializedNNSearch=yn;function bn(o,r,e,t,n,s,i){var u,l,a=A.makeHeap(e.length,t);if(n(t,r,e,a,i),o)try{for(var f=qe(o),h=f.next();!h.done;h=f.next()){var c=h.value;s(c,r,e,a,i)}}catch(p){u={error:p}}finally{try{h&&!h.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}return a}ft.initializeSearch=bn;const Sn=Object.prototype.toString;function Qt(o){return Sn.call(o).endsWith("Array]")}function de(o,r,e){let t=0;const n=e(r);for(let s=0;s<o.x.length;s++)t+=Math.abs(o.y[s]-n(o.x[s]));return t}var F={};const Mn=Object.prototype.toString;function En(o){const r=Mn.call(o);return r.endsWith("Array]")&&!r.includes("Big")}const jn=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:En},Symbol.toStringTag,{value:"Module"})),xn=qt(jn),_n=Object.prototype.toString;function ye(o){const r=_n.call(o);return r.endsWith("Array]")&&!r.includes("Big")}const Rn=Object.prototype.toString;function Nn(o){const r=Rn.call(o);return r.endsWith("Array]")&&!r.includes("Big")}function kn(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nn(o))throw new TypeError("input must be an array");if(o.length===0)throw new TypeError("input must not be empty");var e=r.fromIndex,t=e===void 0?0:e,n=r.toIndex,s=n===void 0?o.length:n;if(t<0||t>=o.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=t||s>o.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var i=o[t],u=t+1;u<s;u++)o[u]>i&&(i=o[u]);return i}const zn=Object.prototype.toString;function In(o){const r=zn.call(o);return r.endsWith("Array]")&&!r.includes("Big")}function Tn(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!In(o))throw new TypeError("input must be an array");if(o.length===0)throw new TypeError("input must not be empty");var e=r.fromIndex,t=e===void 0?0:e,n=r.toIndex,s=n===void 0?o.length:n;if(t<0||t>=o.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=t||s>o.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var i=o[t],u=t+1;u<s;u++)o[u]<i&&(i=o[u]);return i}function Pn(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ye(o)){if(o.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(r.output!==void 0){if(!ye(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(o.length);var t=Tn(o),n=kn(o);if(t===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=r.min,i=s===void 0?r.autoMinMax?t:0:s,u=r.max,l=u===void 0?r.autoMinMax?n:1:u;if(i>=l)throw new RangeError("min option must be smaller than max option");for(var a=(l-i)/(n-t),f=0;f<o.length;f++)e[f]=(o[f]-t)*a+i;return e}const On=Object.freeze(Object.defineProperty({__proto__:null,default:Pn},Symbol.toStringTag,{value:"Module"})),$n=qt(On);Object.defineProperty(F,"__esModule",{value:!0});var et=xn,be=$n;const kt=" ".repeat(2),Ve=" ".repeat(4);function Fn(){return Be(this)}function Be(o,r={}){const{maxRows:e=15,maxColumns:t=10,maxNumSize:n=8,padMinus:s="auto"}=r;return`${o.constructor.name} {
${kt}[
${Ve}${Dn(o,e,t,n,s)}
${kt}]
${kt}rows: ${o.rows}
${kt}columns: ${o.columns}
}`}function Dn(o,r,e,t,n){const{rows:s,columns:i}=o,u=Math.min(s,r),l=Math.min(i,e),a=[];if(n==="auto"){n=!1;t:for(let f=0;f<u;f++)for(let h=0;h<l;h++)if(o.get(f,h)<0){n=!0;break t}}for(let f=0;f<u;f++){let h=[];for(let c=0;c<l;c++)h.push(Cn(o.get(f,c),t,n));a.push(`${h.join(" ")}`)}return l!==i&&(a[a.length-1]+=` ... ${i-e} more columns`),u!==s&&a.push(`... ${s-r} more rows`),a.join(`
${Ve}`)}function Cn(o,r,e){return(o>=0&&e?` ${Se(o,r-1)}`:Se(o,r)).padEnd(r)}function Se(o,r){let e=o.toString();if(e.length<=r)return e;let t=o.toFixed(r);if(t.length>r&&(t=o.toFixed(Math.max(0,r-(t.length-r)))),t.length<=r&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let n=o.toExponential(r);return n.length>r&&(n=o.toExponential(Math.max(0,r-(n.length-r)))),n.slice(0)}function qn(o,r){o.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},o.prototype.addS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)+t);return this},o.prototype.addM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)+t.get(n,s));return this},o.add=function(t,n){return new r(t).add(n)},o.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},o.prototype.subS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)-t);return this},o.prototype.subM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)-t.get(n,s));return this},o.sub=function(t,n){return new r(t).sub(n)},o.prototype.subtract=o.prototype.sub,o.prototype.subtractS=o.prototype.subS,o.prototype.subtractM=o.prototype.subM,o.subtract=o.sub,o.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},o.prototype.mulS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)*t);return this},o.prototype.mulM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)*t.get(n,s));return this},o.mul=function(t,n){return new r(t).mul(n)},o.prototype.multiply=o.prototype.mul,o.prototype.multiplyS=o.prototype.mulS,o.prototype.multiplyM=o.prototype.mulM,o.multiply=o.mul,o.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},o.prototype.divS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)/t);return this},o.prototype.divM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)/t.get(n,s));return this},o.div=function(t,n){return new r(t).div(n)},o.prototype.divide=o.prototype.div,o.prototype.divideS=o.prototype.divS,o.prototype.divideM=o.prototype.divM,o.divide=o.div,o.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},o.prototype.modS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)%t);return this},o.prototype.modM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)%t.get(n,s));return this},o.mod=function(t,n){return new r(t).mod(n)},o.prototype.modulus=o.prototype.mod,o.prototype.modulusS=o.prototype.modS,o.prototype.modulusM=o.prototype.modM,o.modulus=o.mod,o.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},o.prototype.andS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)&t);return this},o.prototype.andM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)&t.get(n,s));return this},o.and=function(t,n){return new r(t).and(n)},o.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},o.prototype.orS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)|t);return this},o.prototype.orM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)|t.get(n,s));return this},o.or=function(t,n){return new r(t).or(n)},o.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},o.prototype.xorS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)^t);return this},o.prototype.xorM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)^t.get(n,s));return this},o.xor=function(t,n){return new r(t).xor(n)},o.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},o.prototype.leftShiftS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)<<t);return this},o.prototype.leftShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)<<t.get(n,s));return this},o.leftShift=function(t,n){return new r(t).leftShift(n)},o.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},o.prototype.signPropagatingRightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>t);return this},o.prototype.signPropagatingRightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>t.get(n,s));return this},o.signPropagatingRightShift=function(t,n){return new r(t).signPropagatingRightShift(n)},o.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},o.prototype.rightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>>t);return this},o.prototype.rightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>>t.get(n,s));return this},o.rightShift=function(t,n){return new r(t).rightShift(n)},o.prototype.zeroFillRightShift=o.prototype.rightShift,o.prototype.zeroFillRightShiftS=o.prototype.rightShiftS,o.prototype.zeroFillRightShiftM=o.prototype.rightShiftM,o.zeroFillRightShift=o.rightShift,o.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,~this.get(t,n));return this},o.not=function(t){return new r(t).not()},o.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.abs(this.get(t,n)));return this},o.abs=function(t){return new r(t).abs()},o.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acos(this.get(t,n)));return this},o.acos=function(t){return new r(t).acos()},o.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acosh(this.get(t,n)));return this},o.acosh=function(t){return new r(t).acosh()},o.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asin(this.get(t,n)));return this},o.asin=function(t){return new r(t).asin()},o.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asinh(this.get(t,n)));return this},o.asinh=function(t){return new r(t).asinh()},o.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atan(this.get(t,n)));return this},o.atan=function(t){return new r(t).atan()},o.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atanh(this.get(t,n)));return this},o.atanh=function(t){return new r(t).atanh()},o.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cbrt(this.get(t,n)));return this},o.cbrt=function(t){return new r(t).cbrt()},o.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.ceil(this.get(t,n)));return this},o.ceil=function(t){return new r(t).ceil()},o.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.clz32(this.get(t,n)));return this},o.clz32=function(t){return new r(t).clz32()},o.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cos(this.get(t,n)));return this},o.cos=function(t){return new r(t).cos()},o.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cosh(this.get(t,n)));return this},o.cosh=function(t){return new r(t).cosh()},o.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.exp(this.get(t,n)));return this},o.exp=function(t){return new r(t).exp()},o.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.expm1(this.get(t,n)));return this},o.expm1=function(t){return new r(t).expm1()},o.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.floor(this.get(t,n)));return this},o.floor=function(t){return new r(t).floor()},o.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.fround(this.get(t,n)));return this},o.fround=function(t){return new r(t).fround()},o.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log(this.get(t,n)));return this},o.log=function(t){return new r(t).log()},o.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log1p(this.get(t,n)));return this},o.log1p=function(t){return new r(t).log1p()},o.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log10(this.get(t,n)));return this},o.log10=function(t){return new r(t).log10()},o.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log2(this.get(t,n)));return this},o.log2=function(t){return new r(t).log2()},o.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.round(this.get(t,n)));return this},o.round=function(t){return new r(t).round()},o.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sign(this.get(t,n)));return this},o.sign=function(t){return new r(t).sign()},o.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sin(this.get(t,n)));return this},o.sin=function(t){return new r(t).sin()},o.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sinh(this.get(t,n)));return this},o.sinh=function(t){return new r(t).sinh()},o.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sqrt(this.get(t,n)));return this},o.sqrt=function(t){return new r(t).sqrt()},o.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tan(this.get(t,n)));return this},o.tan=function(t){return new r(t).tan()},o.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tanh(this.get(t,n)));return this},o.tanh=function(t){return new r(t).tanh()},o.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.trunc(this.get(t,n)));return this},o.trunc=function(t){return new r(t).trunc()},o.pow=function(t,n){return new r(t).pow(n)},o.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},o.prototype.powS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)**t);return this},o.prototype.powM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)**t.get(n,s));return this}}function it(o,r,e){let t=e?o.rows:o.rows-1;if(r<0||r>t)throw new RangeError("Row index out of range")}function lt(o,r,e){let t=e?o.columns:o.columns-1;if(r<0||r>t)throw new RangeError("Column index out of range")}function yt(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.columns)throw new RangeError("vector size must be the same as the number of columns");return r}function bt(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.rows)throw new RangeError("vector size must be the same as the number of rows");return r}function se(o,r){if(!et.isAnyArray(r))throw new TypeError("row indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.rows)throw new RangeError("row indices are out of range")}function ie(o,r){if(!et.isAnyArray(r))throw new TypeError("column indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.columns)throw new RangeError("column indices are out of range")}function ee(o,r,e,t,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(zt("startRow",r),zt("endRow",e),zt("startColumn",t),zt("endColumn",n),r>e||t>n||r<0||r>=o.rows||e<0||e>=o.rows||t<0||t>=o.columns||n<0||n>=o.columns)throw new RangeError("Submatrix indices are out of range")}function Ut(o,r=0){let e=[];for(let t=0;t<o;t++)e.push(r);return e}function zt(o,r){if(typeof r!="number")throw new TypeError(`${o} must be a number`)}function dt(o){if(o.isEmpty())throw new Error("Empty matrix has no elements to index")}function Ln(o){let r=Ut(o.rows);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]+=o.get(e,t);return r}function Vn(o){let r=Ut(o.columns);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]+=o.get(e,t);return r}function Bn(o){let r=0;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r+=o.get(e,t);return r}function Un(o){let r=Ut(o.rows,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]*=o.get(e,t);return r}function Wn(o){let r=Ut(o.columns,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]*=o.get(e,t);return r}function Gn(o){let r=1;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r*=o.get(e,t);return r}function Kn(o,r,e){const t=o.rows,n=o.columns,s=[];for(let i=0;i<t;i++){let u=0,l=0,a=0;for(let f=0;f<n;f++)a=o.get(i,f)-e[i],u+=a,l+=a*a;r?s.push((l-u*u/n)/(n-1)):s.push((l-u*u/n)/n)}return s}function Xn(o,r,e){const t=o.rows,n=o.columns,s=[];for(let i=0;i<n;i++){let u=0,l=0,a=0;for(let f=0;f<t;f++)a=o.get(f,i)-e[i],u+=a,l+=a*a;r?s.push((l-u*u/t)/(t-1)):s.push((l-u*u/t)/t)}return s}function Yn(o,r,e){const t=o.rows,n=o.columns,s=t*n;let i=0,u=0,l=0;for(let a=0;a<t;a++)for(let f=0;f<n;f++)l=o.get(a,f)-e,i+=l,u+=l*l;return r?(u-i*i/s)/(s-1):(u-i*i/s)/s}function Qn(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[e])}function Jn(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[t])}function Zn(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r)}function An(o){const r=[];for(let e=0;e<o.rows;e++){let t=0;for(let n=0;n<o.columns;n++)t+=o.get(e,n)**2/(o.columns-1);r.push(Math.sqrt(t))}return r}function Hn(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[e])}function to(o){const r=[];for(let e=0;e<o.columns;e++){let t=0;for(let n=0;n<o.rows;n++)t+=o.get(n,e)**2/(o.rows-1);r.push(Math.sqrt(t))}return r}function eo(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[t])}function ro(o){const r=o.size-1;let e=0;for(let t=0;t<o.columns;t++)for(let n=0;n<o.rows;n++)e+=o.get(n,t)**2/r;return Math.sqrt(e)}function no(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r)}class P{static from1DArray(r,e,t){if(r*e!==t.length)throw new RangeError("data length does not match given dimensions");let s=new N(r,e);for(let i=0;i<r;i++)for(let u=0;u<e;u++)s.set(i,u,t[i*e+u]);return s}static rowVector(r){let e=new N(1,r.length);for(let t=0;t<r.length;t++)e.set(0,t,r[t]);return e}static columnVector(r){let e=new N(r.length,1);for(let t=0;t<r.length;t++)e.set(t,0,r[t]);return e}static zeros(r,e){return new N(r,e)}static ones(r,e){return new N(r,e).fill(1)}static rand(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:n=Math.random}=t;let s=new N(r,e);for(let i=0;i<r;i++)for(let u=0;u<e;u++)s.set(i,u,n());return s}static randInt(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:s=1e3,random:i=Math.random}=t;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(n>=s)throw new RangeError("min must be smaller than max");let u=s-n,l=new N(r,e);for(let a=0;a<r;a++)for(let f=0;f<e;f++){let h=n+Math.round(i()*u);l.set(a,f,h)}return l}static eye(r,e,t){e===void 0&&(e=r),t===void 0&&(t=1);let n=Math.min(r,e),s=this.zeros(r,e);for(let i=0;i<n;i++)s.set(i,i,t);return s}static diag(r,e,t){let n=r.length;e===void 0&&(e=n),t===void 0&&(t=e);let s=Math.min(n,e,t),i=this.zeros(e,t);for(let u=0;u<s;u++)i.set(u,u,r[u]);return i}static min(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,n=r.columns,s=new N(t,n);for(let i=0;i<t;i++)for(let u=0;u<n;u++)s.set(i,u,Math.min(r.get(i,u),e.get(i,u)));return s}static max(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,n=r.columns,s=new this(t,n);for(let i=0;i<t;i++)for(let u=0;u<n;u++)s.set(i,u,Math.max(r.get(i,u),e.get(i,u)));return s}static checkMatrix(r){return P.isMatrix(r)?r:new N(r)}static isMatrix(r){return r!=null&&r.klass==="Matrix"}get size(){return this.rows*this.columns}apply(r){if(typeof r!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.call(this,e,t);return this}to1DArray(){let r=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}to2DArray(){let r=[];for(let e=0;e<this.rows;e++){r.push([]);for(let t=0;t<this.columns;t++)r[e].push(this.get(e,t))}return r}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let r=0;r<this.rows;r++)for(let e=0;e<=r;e++)if(this.get(r,e)!==this.get(e,r))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let r=0;r<this.rows;r++)if(this.get(r,r)!==0)return!1;return!0}isEchelonForm(){let r=0,e=0,t=-1,n=!0,s=!1;for(;r<this.rows&&n;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(s=!0,t=e):(n=!1,s=!0);r++}return n}isReducedEchelonForm(){let r=0,e=0,t=-1,n=!0,s=!1;for(;r<this.rows&&n;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(s=!0,t=e):(n=!1,s=!0);for(let i=e+1;i<this.rows;i++)this.get(r,i)!==0&&(n=!1);r++}return n}echelonForm(){let r=this.clone(),e=0,t=0;for(;e<r.rows&&t<r.columns;){let n=e;for(let s=e;s<r.rows;s++)r.get(s,t)>r.get(n,t)&&(n=s);if(r.get(n,t)===0)t++;else{r.swapRows(e,n);let s=r.get(e,t);for(let i=t;i<r.columns;i++)r.set(e,i,r.get(e,i)/s);for(let i=e+1;i<r.rows;i++){let u=r.get(i,t)/r.get(e,t);r.set(i,t,0);for(let l=t+1;l<r.columns;l++)r.set(i,l,r.get(i,l)-r.get(e,l)*u)}e++,t++}}return r}reducedEchelonForm(){let r=this.echelonForm(),e=r.columns,t=r.rows,n=t-1;for(;n>=0;)if(r.maxRow(n)===0)n--;else{let s=0,i=!1;for(;s<t&&i===!1;)r.get(n,s)===1?i=!0:s++;for(let u=0;u<n;u++){let l=r.get(u,s);for(let a=s;a<e;a++){let f=r.get(u,a)-l*r.get(n,a);r.set(u,a,f)}}n--}return r}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:t=1}=r;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let n=new N(this.rows*e,this.columns*t);for(let s=0;s<e;s++)for(let i=0;i<t;i++)n.setSubMatrix(this,this.rows*s,this.columns*i);return n}fill(r){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,r);return this}neg(){return this.mulS(-1)}getRow(r){it(this,r);let e=[];for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}getRowVector(r){return N.rowVector(this.getRow(r))}setRow(r,e){it(this,r),e=yt(this,e);for(let t=0;t<this.columns;t++)this.set(r,t,e[t]);return this}swapRows(r,e){it(this,r),it(this,e);for(let t=0;t<this.columns;t++){let n=this.get(r,t);this.set(r,t,this.get(e,t)),this.set(e,t,n)}return this}getColumn(r){lt(this,r);let e=[];for(let t=0;t<this.rows;t++)e.push(this.get(t,r));return e}getColumnVector(r){return N.columnVector(this.getColumn(r))}setColumn(r,e){lt(this,r),e=bt(this,e);for(let t=0;t<this.rows;t++)this.set(t,r,e[t]);return this}swapColumns(r,e){lt(this,r),lt(this,e);for(let t=0;t<this.rows;t++){let n=this.get(t,r);this.set(t,r,this.get(t,e)),this.set(t,e,n)}return this}addRowVector(r){r=yt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[t]);return this}subRowVector(r){r=yt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[t]);return this}mulRowVector(r){r=yt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[t]);return this}divRowVector(r){r=yt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[t]);return this}addColumnVector(r){r=bt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[e]);return this}subColumnVector(r){r=bt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[e]);return this}mulColumnVector(r){r=bt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[e]);return this}divColumnVector(r){r=bt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[e]);return this}mulRow(r,e){it(this,r);for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e);return this}mulColumn(r,e){lt(this,r);for(let t=0;t<this.rows;t++)this.set(t,r,this.get(t,r)*e);return this}max(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e[t]&&(e[t]=this.get(t,n));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e[n]&&(e[n]=this.get(t,n));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}default:throw new Error(`invalid option: ${r}`)}}maxIndex(){dt(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n),e[0]=t,e[1]=n);return e}min(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e[t]&&(e[t]=this.get(t,n));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e[n]&&(e[n]=this.get(t,n));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}default:throw new Error(`invalid option: ${r}`)}}minIndex(){dt(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n),e[0]=t,e[1]=n);return e}maxRow(r){if(it(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxRowIndex(r){it(this,r),dt(this);let e=this.get(r,0),t=[r,0];for(let n=1;n<this.columns;n++)this.get(r,n)>e&&(e=this.get(r,n),t[1]=n);return t}minRow(r){if(it(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)<e&&(e=this.get(r,t));return e}minRowIndex(r){it(this,r),dt(this);let e=this.get(r,0),t=[r,0];for(let n=1;n<this.columns;n++)this.get(r,n)<e&&(e=this.get(r,n),t[1]=n);return t}maxColumn(r){if(lt(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxColumnIndex(r){lt(this,r),dt(this);let e=this.get(0,r),t=[0,r];for(let n=1;n<this.rows;n++)this.get(n,r)>e&&(e=this.get(n,r),t[0]=n);return t}minColumn(r){if(lt(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)<e&&(e=this.get(t,r));return e}minColumnIndex(r){lt(this,r),dt(this);let e=this.get(0,r),t=[0,r];for(let n=1;n<this.rows;n++)this.get(n,r)<e&&(e=this.get(n,r),t[0]=n);return t}diag(){let r=Math.min(this.rows,this.columns),e=[];for(let t=0;t<r;t++)e.push(this.get(t,t));return e}norm(r="frobenius"){switch(r){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${r}`)}}cumulativeSum(){let r=0;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r+=this.get(e,t),this.set(e,t,r);return this}dot(r){P.isMatrix(r)&&(r=r.to1DArray());let e=this.to1DArray();if(e.length!==r.length)throw new RangeError("vectors do not have the same size");let t=0;for(let n=0;n<e.length;n++)t+=e[n]*r[n];return t}mmul(r){r=N.checkMatrix(r);let e=this.rows,t=this.columns,n=r.columns,s=new N(e,n),i=new Float64Array(t);for(let u=0;u<n;u++){for(let l=0;l<t;l++)i[l]=r.get(l,u);for(let l=0;l<e;l++){let a=0;for(let f=0;f<t;f++)a+=this.get(l,f)*i[f];s.set(l,u,a)}}return s}mpow(r){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(r)||r<0)throw new RangeError("Exponent must be a non-negative integer");let e=N.eye(this.rows),t=this;for(let n=r;n>1;n/=2)n&1&&(e=e.mmul(t)),t=t.mmul(t);return e}strassen2x2(r){r=N.checkMatrix(r);let e=new N(2,2);const t=this.get(0,0),n=r.get(0,0),s=this.get(0,1),i=r.get(0,1),u=this.get(1,0),l=r.get(1,0),a=this.get(1,1),f=r.get(1,1),h=(t+a)*(n+f),c=(u+a)*n,p=t*(i-f),m=a*(l-n),v=(t+s)*f,y=(u-t)*(n+i),g=(s-a)*(l+f),b=h+m-v+g,M=p+v,x=c+m,E=h-c+p+y;return e.set(0,0,b),e.set(0,1,M),e.set(1,0,x),e.set(1,1,E),e}strassen3x3(r){r=N.checkMatrix(r);let e=new N(3,3);const t=this.get(0,0),n=this.get(0,1),s=this.get(0,2),i=this.get(1,0),u=this.get(1,1),l=this.get(1,2),a=this.get(2,0),f=this.get(2,1),h=this.get(2,2),c=r.get(0,0),p=r.get(0,1),m=r.get(0,2),v=r.get(1,0),y=r.get(1,1),g=r.get(1,2),b=r.get(2,0),M=r.get(2,1),x=r.get(2,2),E=(t+n+s-i-u-f-h)*y,z=(t-i)*(-p+y),_=u*(-c+p+v-y-g-b+x),R=(-t+i+u)*(c-p+y),I=(i+u)*(-c+p),w=t*c,d=(-t+a+f)*(c-m+g),j=(-t+a)*(m-g),S=(a+f)*(-c+m),O=(t+n+s-u-l-a-f)*g,T=f*(-c+m+v-y-g-b+M),$=(-s+f+h)*(y+b-M),q=(s-h)*(y-M),B=s*b,Y=(f+h)*(-b+M),W=(-s+u+l)*(g+b-x),ht=(s-l)*(g-x),ct=(u+l)*(-b+x),D=n*v,K=l*M,rt=i*m,nt=a*p,G=h*x,rr=w+B+D,nr=E+R+I+w+$+B+Y,or=w+d+S+O+B+W+ct,sr=z+_+R+w+B+W+ht,ir=z+R+I+w+K,lr=B+W+ht+ct+rt,ur=w+d+j+T+$+q+B,ar=$+q+B+Y+nt,hr=w+d+j+S+G;return e.set(0,0,rr),e.set(0,1,nr),e.set(0,2,or),e.set(1,0,sr),e.set(1,1,ir),e.set(1,2,lr),e.set(2,0,ur),e.set(2,1,ar),e.set(2,2,hr),e}mmulStrassen(r){r=N.checkMatrix(r);let e=this.clone(),t=e.rows,n=e.columns,s=r.rows,i=r.columns;n!==s&&console.warn(`Multiplying ${t} x ${n} and ${s} x ${i} matrix: dimensions do not match.`);function u(h,c,p){let m=h.rows,v=h.columns;if(m===c&&v===p)return h;{let y=P.zeros(c,p);return y=y.setSubMatrix(h,0,0),y}}let l=Math.max(t,s),a=Math.max(n,i);e=u(e,l,a),r=u(r,l,a);function f(h,c,p,m){if(p<=512||m<=512)return h.mmul(c);p%2===1&&m%2===1?(h=u(h,p+1,m+1),c=u(c,p+1,m+1)):p%2===1?(h=u(h,p+1,m),c=u(c,p+1,m)):m%2===1&&(h=u(h,p,m+1),c=u(c,p,m+1));let v=parseInt(h.rows/2,10),y=parseInt(h.columns/2,10),g=h.subMatrix(0,v-1,0,y-1),b=c.subMatrix(0,v-1,0,y-1),M=h.subMatrix(0,v-1,y,h.columns-1),x=c.subMatrix(0,v-1,y,c.columns-1),E=h.subMatrix(v,h.rows-1,0,y-1),z=c.subMatrix(v,c.rows-1,0,y-1),_=h.subMatrix(v,h.rows-1,y,h.columns-1),R=c.subMatrix(v,c.rows-1,y,c.columns-1),I=f(P.add(g,_),P.add(b,R),v,y),w=f(P.add(E,_),b,v,y),d=f(g,P.sub(x,R),v,y),j=f(_,P.sub(z,b),v,y),S=f(P.add(g,M),R,v,y),O=f(P.sub(E,g),P.add(b,x),v,y),T=f(P.sub(M,_),P.add(z,R),v,y),$=P.add(I,j);$.sub(S),$.add(T);let q=P.add(d,S),B=P.add(w,j),Y=P.sub(I,w);Y.add(d),Y.add(O);let W=P.zeros(2*$.rows,2*$.columns);return W=W.setSubMatrix($,0,0),W=W.setSubMatrix(q,$.rows,0),W=W.setSubMatrix(B,0,$.columns),W=W.setSubMatrix(Y,$.rows,$.columns),W.subMatrix(0,p-1,0,m-1)}return f(e,r,l,a)}scaleRows(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let n=new N(this.rows,this.columns);for(let s=0;s<this.rows;s++){const i=this.getRow(s);i.length>0&&be(i,{min:e,max:t,output:i}),n.setRow(s,i)}return n}scaleColumns(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let n=new N(this.rows,this.columns);for(let s=0;s<this.columns;s++){const i=this.getColumn(s);i.length&&be(i,{min:e,max:t,output:i}),n.setColumn(s,i)}return n}flipRows(){const r=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let t=0;t<r;t++){let n=this.get(e,t),s=this.get(e,this.columns-1-t);this.set(e,t,s),this.set(e,this.columns-1-t,n)}return this}flipColumns(){const r=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let t=0;t<r;t++){let n=this.get(t,e),s=this.get(this.rows-1-t,e);this.set(t,e,s),this.set(this.rows-1-t,e,n)}return this}kroneckerProduct(r){r=N.checkMatrix(r);let e=this.rows,t=this.columns,n=r.rows,s=r.columns,i=new N(e*n,t*s);for(let u=0;u<e;u++)for(let l=0;l<t;l++)for(let a=0;a<n;a++)for(let f=0;f<s;f++)i.set(n*u+a,s*l+f,this.get(u,l)*r.get(a,f));return i}kroneckerSum(r){if(r=N.checkMatrix(r),!this.isSquare()||!r.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,t=r.rows,n=this.kroneckerProduct(N.eye(t,t)),s=N.eye(e,e).kroneckerProduct(r);return n.add(s)}transpose(){let r=new N(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.set(t,e,this.get(e,t));return r}sortRows(r=Me){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(r));return this}sortColumns(r=Me){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(r));return this}subMatrix(r,e,t,n){ee(this,r,e,t,n);let s=new N(e-r+1,n-t+1);for(let i=r;i<=e;i++)for(let u=t;u<=n;u++)s.set(i-r,u-t,this.get(i,u));return s}subMatrixRow(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.columns-1),e>t||e<0||e>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let n=new N(r.length,t-e+1);for(let s=0;s<r.length;s++)for(let i=e;i<=t;i++){if(r[s]<0||r[s]>=this.rows)throw new RangeError(`Row index out of range: ${r[s]}`);n.set(s,i-e,this.get(r[s],i))}return n}subMatrixColumn(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.rows-1),e>t||e<0||e>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let n=new N(t-e+1,r.length);for(let s=0;s<r.length;s++)for(let i=e;i<=t;i++){if(r[s]<0||r[s]>=this.columns)throw new RangeError(`Column index out of range: ${r[s]}`);n.set(i-e,s,this.get(i,r[s]))}return n}setSubMatrix(r,e,t){if(r=N.checkMatrix(r),r.isEmpty())return this;let n=e+r.rows-1,s=t+r.columns-1;ee(this,e,n,t,s);for(let i=0;i<r.rows;i++)for(let u=0;u<r.columns;u++)this.set(e+i,t+u,r.get(i,u));return this}selection(r,e){se(this,r),ie(this,e);let t=new N(r.length,e.length);for(let n=0;n<r.length;n++){let s=r[n];for(let i=0;i<e.length;i++){let u=e[i];t.set(n,i,this.get(s,u))}}return t}trace(){let r=Math.min(this.rows,this.columns),e=0;for(let t=0;t<r;t++)e+=this.get(t,t);return e}clone(){return this.constructor.copy(this,new N(this.rows,this.columns))}static copy(r,e){for(const[t,n,s]of r.entries())e.set(t,n,s);return e}sum(r){switch(r){case"row":return Ln(this);case"column":return Vn(this);case void 0:return Bn(this);default:throw new Error(`invalid option: ${r}`)}}product(r){switch(r){case"row":return Un(this);case"column":return Wn(this);case void 0:return Gn(this);default:throw new Error(`invalid option: ${r}`)}}mean(r){const e=this.sum(r);switch(r){case"row":{for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e}case"column":{for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${r}`)}}variance(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:n=this.mean(r)}=e;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(r){case"row":{if(!et.isAnyArray(n))throw new TypeError("mean must be an array");return Kn(this,t,n)}case"column":{if(!et.isAnyArray(n))throw new TypeError("mean must be an array");return Xn(this,t,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return Yn(this,t,n)}default:throw new Error(`invalid option: ${r}`)}}standardDeviation(r,e){typeof r=="object"&&(e=r,r=void 0);const t=this.variance(r,e);if(r===void 0)return Math.sqrt(t);for(let n=0;n<t.length;n++)t[n]=Math.sqrt(t[n]);return t}center(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:t=this.mean(r)}=e;switch(r){case"row":{if(!et.isAnyArray(t))throw new TypeError("center must be an array");return Qn(this,t),this}case"column":{if(!et.isAnyArray(t))throw new TypeError("center must be an array");return Jn(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Zn(this,t),this}default:throw new Error(`invalid option: ${r}`)}}scale(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");let t=e.scale;switch(r){case"row":{if(t===void 0)t=An(this);else if(!et.isAnyArray(t))throw new TypeError("scale must be an array");return Hn(this,t),this}case"column":{if(t===void 0)t=to(this);else if(!et.isAnyArray(t))throw new TypeError("scale must be an array");return eo(this,t),this}case void 0:{if(t===void 0)t=ro(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return no(this,t),this}default:throw new Error(`invalid option: ${r}`)}}toString(r){return Be(this,r)}[Symbol.iterator](){return this.entries()}*entries(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield[r,e,this.get(r,e)]}*values(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield this.get(r,e)}}P.prototype.klass="Matrix";typeof Symbol<"u"&&(P.prototype[Symbol.for("nodejs.util.inspect.custom")]=Fn);function Me(o,r){return o-r}function oo(o){return o.every(r=>typeof r=="number")}P.random=P.rand;P.randomInt=P.randInt;P.diagonal=P.diag;P.prototype.diagonal=P.prototype.diag;P.identity=P.eye;P.prototype.negate=P.prototype.neg;P.prototype.tensorProduct=P.prototype.kroneckerProduct;var _t,re,wt;let N=(wt=class extends P{constructor(e,t){super();Xt(this,_t);pe(this,"data");if(wt.isMatrix(e))Yt(this,_t,re).call(this,e.rows,e.columns),wt.copy(e,this);else if(Number.isInteger(e)&&e>=0)Yt(this,_t,re).call(this,e,t);else if(et.isAnyArray(e)){const n=e;if(e=n.length,t=e?n[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<e;s++){if(n[s].length!==t)throw new RangeError("Inconsistent array dimensions");if(!oo(n[s]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[s]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,n){return this.data[e][t]=n,this}get(e,t){return this.data[e][t]}removeRow(e){return it(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),it(this,e,!0),t=Float64Array.from(yt(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){lt(this,e);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns-1);for(let s=0;s<e;s++)n[s]=this.data[t][s];for(let s=e+1;s<this.columns;s++)n[s-1]=this.data[t][s];this.data[t]=n}return this.columns-=1,this}addColumn(e,t){typeof t>"u"&&(t=e,e=this.columns),lt(this,e,!0),t=bt(this,t);for(let n=0;n<this.rows;n++){const s=new Float64Array(this.columns+1);let i=0;for(;i<e;i++)s[i]=this.data[n][i];for(s[i++]=t[n];i<this.columns+1;i++)s[i]=this.data[n][i-1];this.data[n]=s}return this.columns+=1,this}},_t=new WeakSet,re=function(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let n=0;n<e;n++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t},wt);qn(P,N);var Q;const Ct=class Ct extends P{constructor(e){super();Xt(this,Q);if(N.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");Nt(this,Q,N.copy(e,new N(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)Nt(this,Q,new N(e,e));else if(Nt(this,Q,new N(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return ut(this,Q).size}get rows(){return ut(this,Q).rows}get columns(){return ut(this,Q).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return N.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new Ct(this.diagonalSize);for(const[t,n,s]of this.upperRightEntries())e.set(t,n,s);return e}toMatrix(){return new N(this)}get(e,t){return ut(this,Q).get(e,t)}set(e,t,n){return ut(this,Q).set(e,t,n),ut(this,Q).set(t,e,n),this}removeCross(e){return ut(this,Q).removeRow(e),ut(this,Q).removeColumn(e),this}addCross(e,t){t===void 0&&(t=e,e=this.diagonalSize);const n=t.slice();return n.splice(e,1),ut(this,Q).addRow(e,n),ut(this,Q).addColumn(e,t),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const t=[];for(const[n,s]of e.entries())s||t.push(n);t.reverse();for(const n of t)this.removeCross(n);return this}toCompact(){const{diagonalSize:e}=this,t=new Array(e*(e+1)/2);for(let n=0,s=0,i=0;i<t.length;i++)t[i]=this.get(s,n),++n>=e&&(n=++s);return t}static fromCompact(e){const t=e.length,n=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(n))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const s=new Ct(n);for(let i=0,u=0,l=0;l<t;l++)s.set(i,u,e[l]),++i>=n&&(i=++u);return s}*upperRightEntries(){for(let e=0,t=0;e<this.diagonalSize;void 0){const n=this.get(e,t);yield[e,t,n],++t>=this.diagonalSize&&(t=++e)}}*upperRightValues(){for(let e=0,t=0;e<this.diagonalSize;void 0)yield this.get(e,t),++t>=this.diagonalSize&&(t=++e)}};Q=new WeakMap;let pt=Ct;pt.prototype.klassType="SymmetricMatrix";class Wt extends pt{static isDistanceMatrix(r){return pt.isSymmetricMatrix(r)&&r.klassSubType==="DistanceMatrix"}constructor(r){if(super(r),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(r,e,t){return r===e&&(t=0),super.set(r,e,t)}addCross(r,e){return e===void 0&&(e=r,r=this.diagonalSize),e=e.slice(),e[r]=0,super.addCross(r,e)}toSymmetricMatrix(){return new pt(this)}clone(){const r=new Wt(this.diagonalSize);for(const[e,t,n]of this.upperRightEntries())e!==t&&r.set(e,t,n);return r}toCompact(){const{diagonalSize:r}=this,e=(r-1)*r/2,t=new Array(e);for(let n=1,s=0,i=0;i<t.length;i++)t[i]=this.get(s,n),++n>=r&&(n=++s+1);return t}static fromCompact(r){const e=r.length;if(e===0)return new this(0);const t=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(r)}`);const n=new this(t);for(let s=1,i=0,u=0;u<e;u++)n.set(s,i,r[u]),++s>=t&&(s=++i+1);return n}}Wt.prototype.klassSubType="DistanceMatrix";class mt extends P{constructor(r,e,t){super(),this.matrix=r,this.rows=e,this.columns=t}}class so extends mt{constructor(r,e){lt(r,e),super(r,r.rows,1),this.column=e}set(r,e,t){return this.matrix.set(r,this.column,t),this}get(r){return this.matrix.get(r,this.column)}}class io extends mt{constructor(r,e){ie(r,e),super(r,r.rows,e.length),this.columnIndices=e}set(r,e,t){return this.matrix.set(r,this.columnIndices[e],t),this}get(r,e){return this.matrix.get(r,this.columnIndices[e])}}class lo extends mt{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(r,this.columns-e-1,t),this}get(r,e){return this.matrix.get(r,this.columns-e-1)}}class uo extends mt{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(this.rows-r-1,e,t),this}get(r,e){return this.matrix.get(this.rows-r-1,e)}}class ao extends mt{constructor(r,e){it(r,e),super(r,1,r.columns),this.row=e}set(r,e,t){return this.matrix.set(this.row,e,t),this}get(r,e){return this.matrix.get(this.row,e)}}class ho extends mt{constructor(r,e){se(r,e),super(r,e.length,r.columns),this.rowIndices=e}set(r,e,t){return this.matrix.set(this.rowIndices[r],e,t),this}get(r,e){return this.matrix.get(this.rowIndices[r],e)}}class $t extends mt{constructor(r,e,t){se(r,e),ie(r,t),super(r,e.length,t.length),this.rowIndices=e,this.columnIndices=t}set(r,e,t){return this.matrix.set(this.rowIndices[r],this.columnIndices[e],t),this}get(r,e){return this.matrix.get(this.rowIndices[r],this.columnIndices[e])}}class fo extends mt{constructor(r,e,t,n,s){ee(r,e,t,n,s),super(r,t-e+1,s-n+1),this.startRow=e,this.startColumn=n}set(r,e,t){return this.matrix.set(this.startRow+r,this.startColumn+e,t),this}get(r,e){return this.matrix.get(this.startRow+r,this.startColumn+e)}}class co extends mt{constructor(r){super(r,r.columns,r.rows)}set(r,e,t){return this.matrix.set(e,r,t),this}get(r,e){return this.matrix.get(e,r)}}class Ue extends P{constructor(r,e={}){const{rows:t=1}=e;if(r.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=r.length/t,this.data=r}set(r,e,t){let n=this._calculateIndex(r,e);return this.data[n]=t,this}get(r,e){let t=this._calculateIndex(r,e);return this.data[t]}_calculateIndex(r,e){return r*this.columns+e}}class st extends P{constructor(r){super(),this.data=r,this.rows=r.length,this.columns=r[0].length}set(r,e,t){return this.data[r][e]=t,this}get(r,e){return this.data[r][e]}}function go(o,r){if(et.isAnyArray(o))return o[0]&&et.isAnyArray(o[0])?new st(o):new Ue(o,r);throw new Error("the argument is not an array")}class Gt{constructor(r){r=st.checkMatrix(r);let e=r.clone(),t=e.rows,n=e.columns,s=new Float64Array(t),i=1,u,l,a,f,h,c,p,m,v;for(u=0;u<t;u++)s[u]=u;for(m=new Float64Array(t),l=0;l<n;l++){for(u=0;u<t;u++)m[u]=e.get(u,l);for(u=0;u<t;u++){for(v=Math.min(u,l),h=0,a=0;a<v;a++)h+=e.get(u,a)*m[a];m[u]-=h,e.set(u,l,m[u])}for(f=l,u=l+1;u<t;u++)Math.abs(m[u])>Math.abs(m[f])&&(f=u);if(f!==l){for(a=0;a<n;a++)c=e.get(f,a),e.set(f,a,e.get(l,a)),e.set(l,a,c);p=s[f],s[f]=s[l],s[l]=p,i=-i}if(l<t&&e.get(l,l)!==0)for(u=l+1;u<t;u++)e.set(u,l,e.get(u,l)/e.get(l,l))}this.LU=e,this.pivotVector=s,this.pivotSign=i}isSingular(){let r=this.LU,e=r.columns;for(let t=0;t<e;t++)if(r.get(t,t)===0)return!0;return!1}solve(r){r=N.checkMatrix(r);let e=this.LU;if(e.rows!==r.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=r.columns,s=r.subMatrixRow(this.pivotVector,0,n-1),i=e.columns,u,l,a;for(a=0;a<i;a++)for(u=a+1;u<i;u++)for(l=0;l<n;l++)s.set(u,l,s.get(u,l)-s.get(a,l)*e.get(u,a));for(a=i-1;a>=0;a--){for(l=0;l<n;l++)s.set(a,l,s.get(a,l)/e.get(a,a));for(u=0;u<a;u++)for(l=0;l<n;l++)s.set(u,l,s.get(u,l)-s.get(a,l)*e.get(u,a))}return s}get determinant(){let r=this.LU;if(!r.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,t=r.columns;for(let n=0;n<t;n++)e*=r.get(n,n);return e}get lowerTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,n=new N(e,t);for(let s=0;s<e;s++)for(let i=0;i<t;i++)s>i?n.set(s,i,r.get(s,i)):s===i?n.set(s,i,1):n.set(s,i,0);return n}get upperTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,n=new N(e,t);for(let s=0;s<e;s++)for(let i=0;i<t;i++)s<=i?n.set(s,i,r.get(s,i)):n.set(s,i,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function gt(o,r){let e=0;return Math.abs(o)>Math.abs(r)?(e=r/o,Math.abs(o)*Math.sqrt(1+e*e)):r!==0?(e=o/r,Math.abs(r)*Math.sqrt(1+e*e)):0}class le{constructor(r){r=st.checkMatrix(r);let e=r.clone(),t=r.rows,n=r.columns,s=new Float64Array(n),i,u,l,a;for(l=0;l<n;l++){let f=0;for(i=l;i<t;i++)f=gt(f,e.get(i,l));if(f!==0){for(e.get(l,l)<0&&(f=-f),i=l;i<t;i++)e.set(i,l,e.get(i,l)/f);for(e.set(l,l,e.get(l,l)+1),u=l+1;u<n;u++){for(a=0,i=l;i<t;i++)a+=e.get(i,l)*e.get(i,u);for(a=-a/e.get(l,l),i=l;i<t;i++)e.set(i,u,e.get(i,u)+a*e.get(i,l))}}s[l]=-f}this.QR=e,this.Rdiag=s}solve(r){r=N.checkMatrix(r);let e=this.QR,t=e.rows;if(r.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=r.columns,s=r.clone(),i=e.columns,u,l,a,f;for(a=0;a<i;a++)for(l=0;l<n;l++){for(f=0,u=a;u<t;u++)f+=e.get(u,a)*s.get(u,l);for(f=-f/e.get(a,a),u=a;u<t;u++)s.set(u,l,s.get(u,l)+f*e.get(u,a))}for(a=i-1;a>=0;a--){for(l=0;l<n;l++)s.set(a,l,s.get(a,l)/this.Rdiag[a]);for(u=0;u<a;u++)for(l=0;l<n;l++)s.set(u,l,s.get(u,l)-s.get(a,l)*e.get(u,a))}return s.subMatrix(0,i-1,0,n-1)}isFullRank(){let r=this.QR.columns;for(let e=0;e<r;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let r=this.QR,e=r.columns,t=new N(e,e),n,s;for(n=0;n<e;n++)for(s=0;s<e;s++)n<s?t.set(n,s,r.get(n,s)):n===s?t.set(n,s,this.Rdiag[n]):t.set(n,s,0);return t}get orthogonalMatrix(){let r=this.QR,e=r.rows,t=r.columns,n=new N(e,t),s,i,u,l;for(u=t-1;u>=0;u--){for(s=0;s<e;s++)n.set(s,u,0);for(n.set(u,u,1),i=u;i<t;i++)if(r.get(u,u)!==0){for(l=0,s=u;s<e;s++)l+=r.get(s,u)*n.get(s,i);for(l=-l/r.get(u,u),s=u;s<e;s++)n.set(s,i,n.get(s,i)+l*r.get(s,u))}}return n}}class Mt{constructor(r,e={}){if(r=st.checkMatrix(r),r.isEmpty())throw new Error("Matrix must be non-empty");let t=r.rows,n=r.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:i=!0,autoTranspose:u=!1}=e;let l=!!s,a=!!i,f=!1,h;if(t<n)if(!u)h=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{h=r.transpose(),t=h.rows,n=h.columns,f=!0;let w=l;l=a,a=w}else h=r.clone();let c=Math.min(t,n),p=Math.min(t+1,n),m=new Float64Array(p),v=new N(t,c),y=new N(n,n),g=new Float64Array(n),b=new Float64Array(t),M=new Float64Array(p);for(let w=0;w<p;w++)M[w]=w;let x=Math.min(t-1,n),E=Math.max(0,Math.min(n-2,t)),z=Math.max(x,E);for(let w=0;w<z;w++){if(w<x){m[w]=0;for(let d=w;d<t;d++)m[w]=gt(m[w],h.get(d,w));if(m[w]!==0){h.get(w,w)<0&&(m[w]=-m[w]);for(let d=w;d<t;d++)h.set(d,w,h.get(d,w)/m[w]);h.set(w,w,h.get(w,w)+1)}m[w]=-m[w]}for(let d=w+1;d<n;d++){if(w<x&&m[w]!==0){let j=0;for(let S=w;S<t;S++)j+=h.get(S,w)*h.get(S,d);j=-j/h.get(w,w);for(let S=w;S<t;S++)h.set(S,d,h.get(S,d)+j*h.get(S,w))}g[d]=h.get(w,d)}if(l&&w<x)for(let d=w;d<t;d++)v.set(d,w,h.get(d,w));if(w<E){g[w]=0;for(let d=w+1;d<n;d++)g[w]=gt(g[w],g[d]);if(g[w]!==0){g[w+1]<0&&(g[w]=0-g[w]);for(let d=w+1;d<n;d++)g[d]/=g[w];g[w+1]+=1}if(g[w]=-g[w],w+1<t&&g[w]!==0){for(let d=w+1;d<t;d++)b[d]=0;for(let d=w+1;d<t;d++)for(let j=w+1;j<n;j++)b[d]+=g[j]*h.get(d,j);for(let d=w+1;d<n;d++){let j=-g[d]/g[w+1];for(let S=w+1;S<t;S++)h.set(S,d,h.get(S,d)+j*b[S])}}if(a)for(let d=w+1;d<n;d++)y.set(d,w,g[d])}}let _=Math.min(n,t+1);if(x<n&&(m[x]=h.get(x,x)),t<_&&(m[_-1]=0),E+1<_&&(g[E]=h.get(E,_-1)),g[_-1]=0,l){for(let w=x;w<c;w++){for(let d=0;d<t;d++)v.set(d,w,0);v.set(w,w,1)}for(let w=x-1;w>=0;w--)if(m[w]!==0){for(let d=w+1;d<c;d++){let j=0;for(let S=w;S<t;S++)j+=v.get(S,w)*v.get(S,d);j=-j/v.get(w,w);for(let S=w;S<t;S++)v.set(S,d,v.get(S,d)+j*v.get(S,w))}for(let d=w;d<t;d++)v.set(d,w,-v.get(d,w));v.set(w,w,1+v.get(w,w));for(let d=0;d<w-1;d++)v.set(d,w,0)}else{for(let d=0;d<t;d++)v.set(d,w,0);v.set(w,w,1)}}if(a)for(let w=n-1;w>=0;w--){if(w<E&&g[w]!==0)for(let d=w+1;d<n;d++){let j=0;for(let S=w+1;S<n;S++)j+=y.get(S,w)*y.get(S,d);j=-j/y.get(w+1,w);for(let S=w+1;S<n;S++)y.set(S,d,y.get(S,d)+j*y.get(S,w))}for(let d=0;d<n;d++)y.set(d,w,0);y.set(w,w,1)}let R=_-1,I=Number.EPSILON;for(;_>0;){let w,d;for(w=_-2;w>=-1&&w!==-1;w--){const j=Number.MIN_VALUE+I*Math.abs(m[w]+Math.abs(m[w+1]));if(Math.abs(g[w])<=j||Number.isNaN(g[w])){g[w]=0;break}}if(w===_-2)d=4;else{let j;for(j=_-1;j>=w&&j!==w;j--){let S=(j!==_?Math.abs(g[j]):0)+(j!==w+1?Math.abs(g[j-1]):0);if(Math.abs(m[j])<=I*S){m[j]=0;break}}j===w?d=3:j===_-1?d=1:(d=2,w=j)}switch(w++,d){case 1:{let j=g[_-2];g[_-2]=0;for(let S=_-2;S>=w;S--){let O=gt(m[S],j),T=m[S]/O,$=j/O;if(m[S]=O,S!==w&&(j=-$*g[S-1],g[S-1]=T*g[S-1]),a)for(let q=0;q<n;q++)O=T*y.get(q,S)+$*y.get(q,_-1),y.set(q,_-1,-$*y.get(q,S)+T*y.get(q,_-1)),y.set(q,S,O)}break}case 2:{let j=g[w-1];g[w-1]=0;for(let S=w;S<_;S++){let O=gt(m[S],j),T=m[S]/O,$=j/O;if(m[S]=O,j=-$*g[S],g[S]=T*g[S],l)for(let q=0;q<t;q++)O=T*v.get(q,S)+$*v.get(q,w-1),v.set(q,w-1,-$*v.get(q,S)+T*v.get(q,w-1)),v.set(q,S,O)}break}case 3:{const j=Math.max(Math.abs(m[_-1]),Math.abs(m[_-2]),Math.abs(g[_-2]),Math.abs(m[w]),Math.abs(g[w])),S=m[_-1]/j,O=m[_-2]/j,T=g[_-2]/j,$=m[w]/j,q=g[w]/j,B=((O+S)*(O-S)+T*T)/2,Y=S*T*(S*T);let W=0;(B!==0||Y!==0)&&(B<0?W=0-Math.sqrt(B*B+Y):W=Math.sqrt(B*B+Y),W=Y/(B+W));let ht=($+S)*($-S)+W,ct=$*q;for(let D=w;D<_-1;D++){let K=gt(ht,ct);K===0&&(K=Number.MIN_VALUE);let rt=ht/K,nt=ct/K;if(D!==w&&(g[D-1]=K),ht=rt*m[D]+nt*g[D],g[D]=rt*g[D]-nt*m[D],ct=nt*m[D+1],m[D+1]=rt*m[D+1],a)for(let G=0;G<n;G++)K=rt*y.get(G,D)+nt*y.get(G,D+1),y.set(G,D+1,-nt*y.get(G,D)+rt*y.get(G,D+1)),y.set(G,D,K);if(K=gt(ht,ct),K===0&&(K=Number.MIN_VALUE),rt=ht/K,nt=ct/K,m[D]=K,ht=rt*g[D]+nt*m[D+1],m[D+1]=-nt*g[D]+rt*m[D+1],ct=nt*g[D+1],g[D+1]=rt*g[D+1],l&&D<t-1)for(let G=0;G<t;G++)K=rt*v.get(G,D)+nt*v.get(G,D+1),v.set(G,D+1,-nt*v.get(G,D)+rt*v.get(G,D+1)),v.set(G,D,K)}g[_-2]=ht;break}case 4:{if(m[w]<=0&&(m[w]=m[w]<0?-m[w]:0,a))for(let j=0;j<=R;j++)y.set(j,w,-y.get(j,w));for(;w<R&&!(m[w]>=m[w+1]);){let j=m[w];if(m[w]=m[w+1],m[w+1]=j,a&&w<n-1)for(let S=0;S<n;S++)j=y.get(S,w+1),y.set(S,w+1,y.get(S,w)),y.set(S,w,j);if(l&&w<t-1)for(let S=0;S<t;S++)j=v.get(S,w+1),v.set(S,w+1,v.get(S,w)),v.set(S,w,j);w++}_--;break}}}if(f){let w=y;y=v,v=w}this.m=t,this.n=n,this.s=m,this.U=v,this.V=y}solve(r){let e=r,t=this.threshold,n=this.s.length,s=N.zeros(n,n);for(let c=0;c<n;c++)Math.abs(this.s[c])<=t?s.set(c,c,0):s.set(c,c,1/this.s[c]);let i=this.U,u=this.rightSingularVectors,l=u.mmul(s),a=u.rows,f=i.rows,h=N.zeros(a,f);for(let c=0;c<a;c++)for(let p=0;p<f;p++){let m=0;for(let v=0;v<n;v++)m+=l.get(c,v)*i.get(p,v);h.set(c,p,m)}return h.mmul(e)}solveForDiagonal(r){return this.solve(N.diag(r))}inverse(){let r=this.V,e=this.threshold,t=r.rows,n=r.columns,s=new N(t,this.s.length);for(let f=0;f<t;f++)for(let h=0;h<n;h++)Math.abs(this.s[h])>e&&s.set(f,h,r.get(f,h)/this.s[h]);let i=this.U,u=i.rows,l=i.columns,a=new N(t,u);for(let f=0;f<t;f++)for(let h=0;h<u;h++){let c=0;for(let p=0;p<l;p++)c+=s.get(f,p)*i.get(h,p);a.set(f,h,c)}return a}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let r=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let n=0,s=t.length;n<s;n++)t[n]>r&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return N.diag(this.s)}}function mo(o,r=!1){return o=st.checkMatrix(o),r?new Mt(o).inverse():We(o,N.eye(o.rows))}function We(o,r,e=!1){return o=st.checkMatrix(o),r=st.checkMatrix(r),e?new Mt(o).solve(r):o.isSquare()?new Gt(o).solve(r):new le(o).solve(r)}function Ft(o){if(o=N.checkMatrix(o),o.isSquare()){if(o.columns===0)return 1;let r,e,t,n;if(o.columns===2)return r=o.get(0,0),e=o.get(0,1),t=o.get(1,0),n=o.get(1,1),r*n-e*t;if(o.columns===3){let s,i,u;return s=new $t(o,[1,2],[1,2]),i=new $t(o,[1,2],[0,2]),u=new $t(o,[1,2],[0,1]),r=o.get(0,0),e=o.get(0,1),t=o.get(0,2),r*Ft(s)-e*Ft(i)+t*Ft(u)}else return new Gt(o).determinant}else throw Error("determinant can only be calculated for a square matrix")}function po(o,r){let e=[];for(let t=0;t<o;t++)t!==r&&e.push(t);return e}function wo(o,r,e,t=1e-9,n=1e-9){if(o>n)return new Array(r.rows+1).fill(0);{let s=r.addRow(e,[0]);for(let i=0;i<s.rows;i++)Math.abs(s.get(i,0))<t&&s.set(i,0,0);return s.to1DArray()}}function vo(o,r={}){const{thresholdValue:e=1e-9,thresholdError:t=1e-9}=r;o=N.checkMatrix(o);let n=o.rows,s=new N(n,n);for(let i=0;i<n;i++){let u=N.columnVector(o.getRow(i)),l=o.subMatrixRow(po(n,i)).transpose(),f=new Mt(l).solve(u),h=N.sub(u,l.mmul(f)).abs().max();s.setRow(i,wo(h,f,i,e,t))}return s}function yo(o,r=Number.EPSILON){if(o=N.checkMatrix(o),o.isEmpty())return o.transpose();let e=new Mt(o,{autoTranspose:!0}),t=e.leftSingularVectors,n=e.rightSingularVectors,s=e.diagonal;for(let i=0;i<s.length;i++)Math.abs(s[i])>r?s[i]=1/s[i]:s[i]=0;return n.mmul(N.diag(s).mmul(t.transpose()))}function bo(o,r=o,e={}){o=new N(o);let t=!1;if(typeof r=="object"&&!N.isMatrix(r)&&!et.isAnyArray(r)?(e=r,r=o,t=!0):r=new N(r),o.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0}=e;n&&(o=o.center("column"),t||(r=r.center("column")));const s=o.transpose().mmul(r);for(let i=0;i<s.rows;i++)for(let u=0;u<s.columns;u++)s.set(i,u,s.get(i,u)*(1/(o.rows-1)));return s}function So(o,r=o,e={}){o=new N(o);let t=!1;if(typeof r=="object"&&!N.isMatrix(r)&&!et.isAnyArray(r)?(e=r,r=o,t=!0):r=new N(r),o.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0,scale:s=!0}=e;n&&(o.center("column"),t||r.center("column")),s&&(o.scale("column"),t||r.scale("column"));const i=o.standardDeviation("column",{unbiased:!0}),u=t?i:r.standardDeviation("column",{unbiased:!0}),l=o.transpose().mmul(r);for(let a=0;a<l.rows;a++)for(let f=0;f<l.columns;f++)l.set(a,f,l.get(a,f)*(1/(i[a]*u[f]))*(1/(o.rows-1)));return l}class Ge{constructor(r,e={}){const{assumeSymmetric:t=!1}=e;if(r=st.checkMatrix(r),!r.isSquare())throw new Error("Matrix is not a square matrix");if(r.isEmpty())throw new Error("Matrix must be non-empty");let n=r.columns,s=new N(n,n),i=new Float64Array(n),u=new Float64Array(n),l=r,a,f,h=!1;if(t?h=!0:h=r.isSymmetric(),h){for(a=0;a<n;a++)for(f=0;f<n;f++)s.set(a,f,l.get(a,f));Mo(n,u,i,s),Eo(n,u,i,s)}else{let c=new N(n,n),p=new Float64Array(n);for(f=0;f<n;f++)for(a=0;a<n;a++)c.set(a,f,l.get(a,f));jo(n,c,p,s),xo(n,u,i,s,c)}this.n=n,this.e=u,this.d=i,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let r=this.n,e=this.e,t=this.d,n=new N(r,r),s,i;for(s=0;s<r;s++){for(i=0;i<r;i++)n.set(s,i,0);n.set(s,s,t[s]),e[s]>0?n.set(s,s+1,e[s]):e[s]<0&&n.set(s,s-1,e[s])}return n}}function Mo(o,r,e,t){let n,s,i,u,l,a,f,h;for(l=0;l<o;l++)e[l]=t.get(o-1,l);for(u=o-1;u>0;u--){for(h=0,i=0,a=0;a<u;a++)h=h+Math.abs(e[a]);if(h===0)for(r[u]=e[u-1],l=0;l<u;l++)e[l]=t.get(u-1,l),t.set(u,l,0),t.set(l,u,0);else{for(a=0;a<u;a++)e[a]/=h,i+=e[a]*e[a];for(n=e[u-1],s=Math.sqrt(i),n>0&&(s=-s),r[u]=h*s,i=i-n*s,e[u-1]=n-s,l=0;l<u;l++)r[l]=0;for(l=0;l<u;l++){for(n=e[l],t.set(l,u,n),s=r[l]+t.get(l,l)*n,a=l+1;a<=u-1;a++)s+=t.get(a,l)*e[a],r[a]+=t.get(a,l)*n;r[l]=s}for(n=0,l=0;l<u;l++)r[l]/=i,n+=r[l]*e[l];for(f=n/(i+i),l=0;l<u;l++)r[l]-=f*e[l];for(l=0;l<u;l++){for(n=e[l],s=r[l],a=l;a<=u-1;a++)t.set(a,l,t.get(a,l)-(n*r[a]+s*e[a]));e[l]=t.get(u-1,l),t.set(u,l,0)}}e[u]=i}for(u=0;u<o-1;u++){if(t.set(o-1,u,t.get(u,u)),t.set(u,u,1),i=e[u+1],i!==0){for(a=0;a<=u;a++)e[a]=t.get(a,u+1)/i;for(l=0;l<=u;l++){for(s=0,a=0;a<=u;a++)s+=t.get(a,u+1)*t.get(a,l);for(a=0;a<=u;a++)t.set(a,l,t.get(a,l)-s*e[a])}}for(a=0;a<=u;a++)t.set(a,u+1,0)}for(l=0;l<o;l++)e[l]=t.get(o-1,l),t.set(o-1,l,0);t.set(o-1,o-1,1),r[0]=0}function Eo(o,r,e,t){let n,s,i,u,l,a,f,h,c,p,m,v,y,g,b,M;for(i=1;i<o;i++)r[i-1]=r[i];r[o-1]=0;let x=0,E=0,z=Number.EPSILON;for(a=0;a<o;a++){for(E=Math.max(E,Math.abs(e[a])+Math.abs(r[a])),f=a;f<o&&!(Math.abs(r[f])<=z*E);)f++;if(f>a)do{for(n=e[a],h=(e[a+1]-n)/(2*r[a]),c=gt(h,1),h<0&&(c=-c),e[a]=r[a]/(h+c),e[a+1]=r[a]*(h+c),p=e[a+1],s=n-e[a],i=a+2;i<o;i++)e[i]-=s;for(x=x+s,h=e[f],m=1,v=m,y=m,g=r[a+1],b=0,M=0,i=f-1;i>=a;i--)for(y=v,v=m,M=b,n=m*r[i],s=m*h,c=gt(h,r[i]),r[i+1]=b*c,b=r[i]/c,m=h/c,h=m*e[i]-b*n,e[i+1]=s+b*(m*n+b*e[i]),l=0;l<o;l++)s=t.get(l,i+1),t.set(l,i+1,b*t.get(l,i)+m*s),t.set(l,i,m*t.get(l,i)-b*s);h=-b*M*y*g*r[a]/p,r[a]=b*h,e[a]=m*h}while(Math.abs(r[a])>z*E);e[a]=e[a]+x,r[a]=0}for(i=0;i<o-1;i++){for(l=i,h=e[i],u=i+1;u<o;u++)e[u]<h&&(l=u,h=e[u]);if(l!==i)for(e[l]=e[i],e[i]=h,u=0;u<o;u++)h=t.get(u,i),t.set(u,i,t.get(u,l)),t.set(u,l,h)}}function jo(o,r,e,t){let n=0,s=o-1,i,u,l,a,f,h,c;for(h=n+1;h<=s-1;h++){for(c=0,a=h;a<=s;a++)c=c+Math.abs(r.get(a,h-1));if(c!==0){for(l=0,a=s;a>=h;a--)e[a]=r.get(a,h-1)/c,l+=e[a]*e[a];for(u=Math.sqrt(l),e[h]>0&&(u=-u),l=l-e[h]*u,e[h]=e[h]-u,f=h;f<o;f++){for(i=0,a=s;a>=h;a--)i+=e[a]*r.get(a,f);for(i=i/l,a=h;a<=s;a++)r.set(a,f,r.get(a,f)-i*e[a])}for(a=0;a<=s;a++){for(i=0,f=s;f>=h;f--)i+=e[f]*r.get(a,f);for(i=i/l,f=h;f<=s;f++)r.set(a,f,r.get(a,f)-i*e[f])}e[h]=c*e[h],r.set(h,h-1,c*u)}}for(a=0;a<o;a++)for(f=0;f<o;f++)t.set(a,f,a===f?1:0);for(h=s-1;h>=n+1;h--)if(r.get(h,h-1)!==0){for(a=h+1;a<=s;a++)e[a]=r.get(a,h-1);for(f=h;f<=s;f++){for(u=0,a=h;a<=s;a++)u+=e[a]*t.get(a,f);for(u=u/e[h]/r.get(h,h-1),a=h;a<=s;a++)t.set(a,f,t.get(a,f)+u*e[a])}}}function xo(o,r,e,t,n){let s=o-1,i=0,u=o-1,l=Number.EPSILON,a=0,f=0,h=0,c=0,p=0,m=0,v=0,y=0,g,b,M,x,E,z,_,R,I,w,d,j,S,O,T;for(g=0;g<o;g++)for((g<i||g>u)&&(e[g]=n.get(g,g),r[g]=0),b=Math.max(g-1,0);b<o;b++)f=f+Math.abs(n.get(g,b));for(;s>=i;){for(x=s;x>i&&(m=Math.abs(n.get(x-1,x-1))+Math.abs(n.get(x,x)),m===0&&(m=f),!(Math.abs(n.get(x,x-1))<l*m));)x--;if(x===s)n.set(s,s,n.get(s,s)+a),e[s]=n.get(s,s),r[s]=0,s--,y=0;else if(x===s-1){if(_=n.get(s,s-1)*n.get(s-1,s),h=(n.get(s-1,s-1)-n.get(s,s))/2,c=h*h+_,v=Math.sqrt(Math.abs(c)),n.set(s,s,n.get(s,s)+a),n.set(s-1,s-1,n.get(s-1,s-1)+a),R=n.get(s,s),c>=0){for(v=h>=0?h+v:h-v,e[s-1]=R+v,e[s]=e[s-1],v!==0&&(e[s]=R-_/v),r[s-1]=0,r[s]=0,R=n.get(s,s-1),m=Math.abs(R)+Math.abs(v),h=R/m,c=v/m,p=Math.sqrt(h*h+c*c),h=h/p,c=c/p,b=s-1;b<o;b++)v=n.get(s-1,b),n.set(s-1,b,c*v+h*n.get(s,b)),n.set(s,b,c*n.get(s,b)-h*v);for(g=0;g<=s;g++)v=n.get(g,s-1),n.set(g,s-1,c*v+h*n.get(g,s)),n.set(g,s,c*n.get(g,s)-h*v);for(g=i;g<=u;g++)v=t.get(g,s-1),t.set(g,s-1,c*v+h*t.get(g,s)),t.set(g,s,c*t.get(g,s)-h*v)}else e[s-1]=R+h,e[s]=R+h,r[s-1]=v,r[s]=-v;s=s-2,y=0}else{if(R=n.get(s,s),I=0,_=0,x<s&&(I=n.get(s-1,s-1),_=n.get(s,s-1)*n.get(s-1,s)),y===10){for(a+=R,g=i;g<=s;g++)n.set(g,g,n.get(g,g)-R);m=Math.abs(n.get(s,s-1))+Math.abs(n.get(s-1,s-2)),R=I=.75*m,_=-.4375*m*m}if(y===30&&(m=(I-R)/2,m=m*m+_,m>0)){for(m=Math.sqrt(m),I<R&&(m=-m),m=R-_/((I-R)/2+m),g=i;g<=s;g++)n.set(g,g,n.get(g,g)-m);a+=m,R=I=_=.964}for(y=y+1,E=s-2;E>=x&&(v=n.get(E,E),p=R-v,m=I-v,h=(p*m-_)/n.get(E+1,E)+n.get(E,E+1),c=n.get(E+1,E+1)-v-p-m,p=n.get(E+2,E+1),m=Math.abs(h)+Math.abs(c)+Math.abs(p),h=h/m,c=c/m,p=p/m,!(E===x||Math.abs(n.get(E,E-1))*(Math.abs(c)+Math.abs(p))<l*(Math.abs(h)*(Math.abs(n.get(E-1,E-1))+Math.abs(v)+Math.abs(n.get(E+1,E+1))))));)E--;for(g=E+2;g<=s;g++)n.set(g,g-2,0),g>E+2&&n.set(g,g-3,0);for(M=E;M<=s-1&&(O=M!==s-1,M!==E&&(h=n.get(M,M-1),c=n.get(M+1,M-1),p=O?n.get(M+2,M-1):0,R=Math.abs(h)+Math.abs(c)+Math.abs(p),R!==0&&(h=h/R,c=c/R,p=p/R)),R!==0);M++)if(m=Math.sqrt(h*h+c*c+p*p),h<0&&(m=-m),m!==0){for(M!==E?n.set(M,M-1,-m*R):x!==E&&n.set(M,M-1,-n.get(M,M-1)),h=h+m,R=h/m,I=c/m,v=p/m,c=c/h,p=p/h,b=M;b<o;b++)h=n.get(M,b)+c*n.get(M+1,b),O&&(h=h+p*n.get(M+2,b),n.set(M+2,b,n.get(M+2,b)-h*v)),n.set(M,b,n.get(M,b)-h*R),n.set(M+1,b,n.get(M+1,b)-h*I);for(g=0;g<=Math.min(s,M+3);g++)h=R*n.get(g,M)+I*n.get(g,M+1),O&&(h=h+v*n.get(g,M+2),n.set(g,M+2,n.get(g,M+2)-h*p)),n.set(g,M,n.get(g,M)-h),n.set(g,M+1,n.get(g,M+1)-h*c);for(g=i;g<=u;g++)h=R*t.get(g,M)+I*t.get(g,M+1),O&&(h=h+v*t.get(g,M+2),t.set(g,M+2,t.get(g,M+2)-h*p)),t.set(g,M,t.get(g,M)-h),t.set(g,M+1,t.get(g,M+1)-h*c)}}}if(f!==0){for(s=o-1;s>=0;s--)if(h=e[s],c=r[s],c===0)for(x=s,n.set(s,s,1),g=s-1;g>=0;g--){for(_=n.get(g,g)-h,p=0,b=x;b<=s;b++)p=p+n.get(g,b)*n.get(b,s);if(r[g]<0)v=_,m=p;else if(x=g,r[g]===0?n.set(g,s,_!==0?-p/_:-p/(l*f)):(R=n.get(g,g+1),I=n.get(g+1,g),c=(e[g]-h)*(e[g]-h)+r[g]*r[g],z=(R*m-v*p)/c,n.set(g,s,z),n.set(g+1,s,Math.abs(R)>Math.abs(v)?(-p-_*z)/R:(-m-I*z)/v)),z=Math.abs(n.get(g,s)),l*z*z>1)for(b=g;b<=s;b++)n.set(b,s,n.get(b,s)/z)}else if(c<0)for(x=s-1,Math.abs(n.get(s,s-1))>Math.abs(n.get(s-1,s))?(n.set(s-1,s-1,c/n.get(s,s-1)),n.set(s-1,s,-(n.get(s,s)-h)/n.get(s,s-1))):(T=It(0,-n.get(s-1,s),n.get(s-1,s-1)-h,c),n.set(s-1,s-1,T[0]),n.set(s-1,s,T[1])),n.set(s,s-1,0),n.set(s,s,1),g=s-2;g>=0;g--){for(w=0,d=0,b=x;b<=s;b++)w=w+n.get(g,b)*n.get(b,s-1),d=d+n.get(g,b)*n.get(b,s);if(_=n.get(g,g)-h,r[g]<0)v=_,p=w,m=d;else if(x=g,r[g]===0?(T=It(-w,-d,_,c),n.set(g,s-1,T[0]),n.set(g,s,T[1])):(R=n.get(g,g+1),I=n.get(g+1,g),j=(e[g]-h)*(e[g]-h)+r[g]*r[g]-c*c,S=(e[g]-h)*2*c,j===0&&S===0&&(j=l*f*(Math.abs(_)+Math.abs(c)+Math.abs(R)+Math.abs(I)+Math.abs(v))),T=It(R*p-v*w+c*d,R*m-v*d-c*w,j,S),n.set(g,s-1,T[0]),n.set(g,s,T[1]),Math.abs(R)>Math.abs(v)+Math.abs(c)?(n.set(g+1,s-1,(-w-_*n.get(g,s-1)+c*n.get(g,s))/R),n.set(g+1,s,(-d-_*n.get(g,s)-c*n.get(g,s-1))/R)):(T=It(-p-I*n.get(g,s-1),-m-I*n.get(g,s),v,c),n.set(g+1,s-1,T[0]),n.set(g+1,s,T[1]))),z=Math.max(Math.abs(n.get(g,s-1)),Math.abs(n.get(g,s))),l*z*z>1)for(b=g;b<=s;b++)n.set(b,s-1,n.get(b,s-1)/z),n.set(b,s,n.get(b,s)/z)}for(g=0;g<o;g++)if(g<i||g>u)for(b=g;b<o;b++)t.set(g,b,n.get(g,b));for(b=o-1;b>=i;b--)for(g=i;g<=u;g++){for(v=0,M=i;M<=Math.min(b,u);M++)v=v+t.get(g,M)*n.get(M,b);t.set(g,b,v)}}}function It(o,r,e,t){let n,s;return Math.abs(e)>Math.abs(t)?(n=t/e,s=e+n*t,[(o+n*r)/s,(r-n*o)/s]):(n=e/t,s=t+n*e,[(n*o+r)/s,(n*r-o)/s])}class Ke{constructor(r){if(r=st.checkMatrix(r),!r.isSymmetric())throw new Error("Matrix is not symmetric");let e=r,t=e.rows,n=new N(t,t),s=!0,i,u,l;for(u=0;u<t;u++){let a=0;for(l=0;l<u;l++){let f=0;for(i=0;i<l;i++)f+=n.get(l,i)*n.get(u,i);f=(e.get(u,l)-f)/n.get(l,l),n.set(u,l,f),a=a+f*f}for(a=e.get(u,u)-a,s&&(s=a>0),n.set(u,u,Math.sqrt(Math.max(a,0))),l=u+1;l<t;l++)n.set(u,l,0)}this.L=n,this.positiveDefinite=s}isPositiveDefinite(){return this.positiveDefinite}solve(r){r=st.checkMatrix(r);let e=this.L,t=e.rows;if(r.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let n=r.columns,s=r.clone(),i,u,l;for(l=0;l<t;l++)for(u=0;u<n;u++){for(i=0;i<l;i++)s.set(l,u,s.get(l,u)-s.get(i,u)*e.get(l,i));s.set(l,u,s.get(l,u)/e.get(l,l))}for(l=t-1;l>=0;l--)for(u=0;u<n;u++){for(i=l+1;i<t;i++)s.set(l,u,s.get(l,u)-s.get(i,u)*e.get(i,l));s.set(l,u,s.get(l,u)/e.get(l,l))}return s}get lowerTriangularMatrix(){return this.L}}class Xe{constructor(r,e={}){r=st.checkMatrix(r);let{Y:t}=e;const{scaleScores:n=!1,maxIterations:s=1e3,terminationCriteria:i=1e-10}=e;let u;if(t){if(et.isAnyArray(t)&&typeof t[0]=="number"?t=N.columnVector(t):t=st.checkMatrix(t),t.rows!==r.rows)throw new Error("Y should have the same number of rows as X");u=t.getColumnVector(0)}else u=r.getColumnVector(0);let l=1,a,f,h,c;for(let p=0;p<s&&l>i;p++)h=r.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),h=h.div(h.norm()),a=r.mmul(h).div(h.transpose().mmul(h).get(0,0)),p>0&&(l=a.clone().sub(c).pow(2).sum()),c=a.clone(),t?(f=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),f=f.div(f.norm()),u=t.mmul(f).div(f.transpose().mmul(f).get(0,0))):u=a;if(t){let p=r.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0));p=p.div(p.norm());let m=r.clone().sub(a.clone().mmul(p.transpose())),v=u.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),y=t.clone().sub(a.clone().mulS(v.get(0,0)).mmul(f.transpose()));this.t=a,this.p=p.transpose(),this.w=h.transpose(),this.q=f,this.u=u,this.s=a.transpose().mmul(a),this.xResidual=m,this.yResidual=y,this.betas=v}else this.w=h.transpose(),this.s=a.transpose().mmul(a).sqrt(),n?this.t=a.clone().div(this.s.get(0,0)):this.t=a,this.xResidual=r.sub(a.mmul(h.transpose()))}}F.AbstractMatrix=P;F.CHO=Ke;F.CholeskyDecomposition=Ke;F.DistanceMatrix=Wt;F.EVD=Ge;F.EigenvalueDecomposition=Ge;F.LU=Gt;F.LuDecomposition=Gt;var Ye=F.Matrix=N;F.MatrixColumnSelectionView=io;F.MatrixColumnView=so;F.MatrixFlipColumnView=lo;F.MatrixFlipRowView=uo;F.MatrixRowSelectionView=ho;F.MatrixRowView=ao;F.MatrixSelectionView=$t;F.MatrixSubView=fo;F.MatrixTransposeView=co;F.NIPALS=Xe;F.Nipals=Xe;F.QR=le;F.QrDecomposition=le;F.SVD=Mt;F.SingularValueDecomposition=Mt;F.SymmetricMatrix=pt;F.WrapperMatrix1D=Ue;F.WrapperMatrix2D=st;F.correlation=So;F.covariance=bo;var Ee=F.default=N;F.determinant=Ft;var _o=F.inverse=mo;F.linearDependencies=vo;F.pseudoInverse=yo;F.solve=We;F.wrap=go;const Dt=Ye;Ee.Matrix&&Ee.Matrix;const Ro=_o;function No(o,r,e,t,n){const s=e.length,i=o.x.length;let u=new Array(s);for(let l=0;l<s;l++){u[l]=new Array(i);let a=e.slice();a[l]+=t;let f=n(a);for(let h=0;h<i;h++)u[l][h]=r[h]-f(o.x[h])}return new Dt(u)}function ko(o,r){const e=o.x.length;let t=new Array(e);for(let n=0;n<e;n++)t[n]=[o.y[n]-r[n]];return new Dt(t)}function zo(o,r,e,t,n){let s=e*t*t,i=Dt.eye(r.length,r.length,s);const u=n(r);let l=new Float64Array(o.x.length);for(let c=0;c<o.x.length;c++)l[c]=u(o.x[c]);let a=No(o,l,r,t,n),f=ko(o,l),h=Ro(i.add(a.mmul(a.transpose())));return r=new Dt([r]),r=r.sub(h.mmul(a).mmul(f).mul(t).transpose()),r.to1DArray()}function Io(o,r,e={}){let{maxIterations:t=100,gradientDifference:n=.1,damping:s=0,errorTolerance:i=.01,minValues:u,maxValues:l,initialValues:a}=e;if(s<=0)throw new Error("The damping option must be a positive number");if(!o.x||!o.y)throw new Error("The data parameter must have x and y elements");if(!Qt(o.x)||o.x.length<2||!Qt(o.y)||o.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(o.x.length!==o.y.length)throw new Error("The data parameter elements must have the same size");let f=a||new Array(r.length).fill(1),h=f.length;if(l=l||new Array(h).fill(Number.MAX_SAFE_INTEGER),u=u||new Array(h).fill(Number.MIN_SAFE_INTEGER),l.length!==u.length)throw new Error("minValues and maxValues must be the same size");if(!Qt(f))throw new Error("initialValues must be an array");let c=de(o,f,r),p=c<=i,m;for(m=0;m<t&&!p;m++){f=zo(o,f,s,n,r);for(let v=0;v<h;v++)f[v]=Math.min(Math.max(u[v],f[v]),l[v]);if(c=de(o,f,r),isNaN(c))break;p=c<=i}return{parameterValues:f,parameterError:c,iterations:m}}const To=Object.freeze(Object.defineProperty({__proto__:null,default:Io},Symbol.toStringTag,{value:"Module"})),Po=qt(To);var Oo=k&&k.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),$o=k&&k.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),Rt=k&&k.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&Oo(r,o,e);return $o(r,o),r},je=k&&k.__awaiter||function(o,r,e,t){function n(s){return s instanceof e?s:new e(function(i){i(s)})}return new(e||(e=Promise))(function(s,i){function u(f){try{a(t.next(f))}catch(h){i(h)}}function l(f){try{a(t.throw(f))}catch(h){i(h)}}function a(f){f.done?s(f.value):n(f.value).then(u,l)}a((t=t.apply(o,r||[])).next())})},xe=k&&k.__generator||function(o,r){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},t,n,s,i;return i={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(a){return function(f){return l([a,f])}}function l(a){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,n&&(s=a[0]&2?n.return:a[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,a[1])).done)return s;switch(n=0,s&&(a=[a[0]&2,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,n=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){e.label=a[1];break}if(a[0]===6&&e.label<s[1]){e.label=s[1],s=a;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(a);break}s[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(o,e)}catch(f){a=[6,f],n=0}finally{t=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},ne=k&&k.__read||function(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var t=e.call(o),n,s=[],i;try{for(;(r===void 0||r-- >0)&&!(n=t.next()).done;)s.push(n.value)}catch(u){i={error:u}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(i)throw i.error}}return s},_e=k&&k.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(ne(arguments[r]));return o},Fo=k&&k.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(J,"__esModule",{value:!0});J.initTransform=J.resetLocalConnectivity=J.fastIntersection=J.findABParams=J.cosine=J.euclidean=J.UMAP=void 0;var Do=Rt(X),V=Rt(L),Tt=Rt(ft),Re=Rt(at),U=Rt(C),Co=Fo(Po),Ne=1e-5,Pt=.001,qo=function(){function o(r){var e=this;r===void 0&&(r={}),this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=Qe,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new Vo;var t=function(n){r[n]!==void 0&&(e[n]=r[n])};t("distanceFn"),t("learningRate"),t("localConnectivity"),t("minDist"),t("nComponents"),t("nEpochs"),t("nNeighbors"),t("negativeSampleRate"),t("random"),t("repulsionStrength"),t("setOpMixRatio"),t("spread"),t("transformQueueSize")}return o.prototype.fit=function(r){return this.initializeFit(r),this.optimizeLayout(),this.embedding},o.prototype.fitAsync=function(r,e){return e===void 0&&(e=function(){return!0}),je(this,void 0,void 0,function(){return xe(this,function(t){switch(t.label){case 0:return this.initializeFit(r),[4,this.optimizeLayoutAsync(e)];case 1:return t.sent(),[2,this.embedding]}})})},o.prototype.setSupervisedProjection=function(r,e){e===void 0&&(e={}),this.Y=r,this.targetMetric=e.targetMetric||this.targetMetric,this.targetWeight=e.targetWeight||this.targetWeight,this.targetNNeighbors=e.targetNNeighbors||this.targetNNeighbors},o.prototype.setPrecomputedKNN=function(r,e){this.knnIndices=r,this.knnDistances=e},o.prototype.initializeFit=function(r){if(r.length<=this.nNeighbors)throw new Error("Not enough data points ("+r.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===r&&this.isInitialized)return this.getNEpochs();if(this.X=r,!this.knnIndices&&!this.knnDistances){var e=this.nearestNeighbors(r);this.knnIndices=e.knnIndices,this.knnDistances=e.knnDistances}this.graph=this.fuzzySimplicialSet(r,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(r),this.processGraphForSupervisedProjection();var t=this.initializeSimplicialSetEmbedding(),n=t.head,s=t.tail,i=t.epochsPerSample;return this.optimizationState.head=n,this.optimizationState.tail=s,this.optimizationState.epochsPerSample=i,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},o.prototype.makeSearchFns=function(){var r=Tt.makeInitializations(this.distanceFn),e=r.initFromTree,t=r.initFromRandom;this.initFromTree=e,this.initFromRandom=t,this.search=Tt.makeInitializedNNSearch(this.distanceFn)},o.prototype.makeSearchGraph=function(r){for(var e=this.knnIndices,t=this.knnDistances,n=[r.length,r.length],s=new V.SparseMatrix([],[],[],n),i=0;i<e.length;i++)for(var u=e[i],l=t[i],a=0;a<u.length;a++){var f=u[a],h=l[a];h>0&&s.set(i,f,h)}var c=V.transpose(s);return V.maximum(s,c)},o.prototype.transform=function(r){var e=this,t=this.X;if(t===void 0||t.length===0)throw new Error("No data has been fit.");var n=Math.floor(this.nNeighbors*this.transformQueueSize);n=Math.min(t.length,n);var s=Tt.initializeSearch(this.rpForest,t,r,n,this.initFromRandom,this.initFromTree,this.random),i=this.search(t,this.searchGraph,s,r),u=Do.deheapSort(i),l=u.indices,a=u.weights;l=l.map(function(T){return T.slice(0,e.nNeighbors)}),a=a.map(function(T){return T.slice(0,e.nNeighbors)});var f=Math.max(0,this.localConnectivity-1),h=this.smoothKNNDistance(a,this.nNeighbors,f),c=h.sigmas,p=h.rhos,m=this.computeMembershipStrengths(l,a,c,p),v=m.rows,y=m.cols,g=m.vals,b=[r.length,t.length],M=new V.SparseMatrix(v,y,g,b),x=V.normalize(M,"l1"),E=V.getCSR(x),z=r.length,_=U.reshape2d(E.indices,z,this.nNeighbors),R=U.reshape2d(E.values,z,this.nNeighbors),I=He(_,R,this.embedding),w=this.nEpochs?this.nEpochs/3:M.nRows<=1e4?100:30,d=M.getValues().reduce(function(T,$){return $>T?$:T},0);M=M.map(function(T){return T<d/w?0:T}),M=V.eliminateZeros(M);var j=this.makeEpochsPerSample(M.getValues(),w),S=M.getRows(),O=M.getCols();return this.assignOptimizationStateParameters({headEmbedding:I,tailEmbedding:this.embedding,head:S,tail:O,currentEpoch:0,nEpochs:w,nVertices:M.getDims()[1],epochsPerSample:j}),this.prepareForOptimizationLoop(),this.optimizeLayout()},o.prototype.processGraphForSupervisedProjection=function(){var r=this,e=r.Y,t=r.X;if(e){if(e.length!==t.length)throw new Error("Length of X and y must be equal");if(this.targetMetric==="categorical"){var n=this.targetWeight<1,s=n?2.5*(1/(1-this.targetWeight)):1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,e,s)}}},o.prototype.step=function(){var r=this.optimizationState.currentEpoch;return r<this.getNEpochs()&&this.optimizeLayoutStep(r),this.optimizationState.currentEpoch},o.prototype.getEmbedding=function(){return this.embedding},o.prototype.nearestNeighbors=function(r){var e=this,t=e.distanceFn,n=e.nNeighbors,s=function(m){return Math.log(m)/Math.log(2)},i=Tt.makeNNDescent(t,this.random),u=function(m){return m===.5?0:Math.round(m)},l=5+Math.floor(u(Math.pow(r.length,.5)/20)),a=Math.max(5,Math.floor(Math.round(s(r.length))));this.rpForest=Re.makeForest(r,n,l,this.random);var f=Re.makeLeafArray(this.rpForest),h=i(r,f,n,a),c=h.indices,p=h.weights;return{knnIndices:c,knnDistances:p}},o.prototype.fuzzySimplicialSet=function(r,e,t){t===void 0&&(t=1);var n=this,s=n.knnIndices,i=s===void 0?[]:s,u=n.knnDistances,l=u===void 0?[]:u,a=n.localConnectivity,f=this.smoothKNNDistance(l,e,a),h=f.sigmas,c=f.rhos,p=this.computeMembershipStrengths(i,l,h,c),m=p.rows,v=p.cols,y=p.vals,g=[r.length,r.length],b=new V.SparseMatrix(m,v,y,g),M=V.transpose(b),x=V.pairwiseMultiply(b,M),E=V.subtract(V.add(b,M),x),z=V.multiplyScalar(E,t),_=V.multiplyScalar(x,1-t),R=V.add(z,_);return R},o.prototype.categoricalSimplicialSetIntersection=function(r,e,t,n){n===void 0&&(n=1);var s=Ze(r,e,n,t);return s=V.eliminateZeros(s),Ae(s)},o.prototype.smoothKNNDistance=function(r,e,t,n,s){t===void 0&&(t=1),n===void 0&&(n=64),s===void 0&&(s=1);for(var i=Math.log(e)/Math.log(2)*s,u=U.zeros(r.length),l=U.zeros(r.length),a=0;a<r.length;a++){var f=0,h=1/0,c=1,p=r[a],m=p.filter(function(_){return _>0});if(m.length>=t){var v=Math.floor(t),y=t-v;v>0?(u[a]=m[v-1],y>Ne&&(u[a]+=y*(m[v]-m[v-1]))):u[a]=y*m[0]}else m.length>0&&(u[a]=U.max(m));for(var g=0;g<n;g++){for(var b=0,M=1;M<r[a].length;M++){var x=r[a][M]-u[a];x>0?b+=Math.exp(-(x/c)):b+=1}if(Math.abs(b-i)<Ne)break;b>i?(h=c,c=(f+h)/2):(f=c,h===1/0?c*=2:c=(f+h)/2)}if(l[a]=c,u[a]>0){var E=U.mean(p);l[a]<Pt*E&&(l[a]=Pt*E)}else{var z=U.mean(r.map(U.mean));l[a]<Pt*z&&(l[a]=Pt*z)}}return{sigmas:l,rhos:u}},o.prototype.computeMembershipStrengths=function(r,e,t,n){for(var s=r.length,i=r[0].length,u=U.zeros(s*i),l=U.zeros(s*i),a=U.zeros(s*i),f=0;f<s;f++)for(var h=0;h<i;h++){var c=0;r[f][h]!==-1&&(r[f][h]===f?c=0:e[f][h]-n[f]<=0?c=1:c=Math.exp(-((e[f][h]-n[f])/t[f])),u[f*i+h]=f,l[f*i+h]=r[f][h],a[f*i+h]=c)}return{rows:u,cols:l,vals:a}},o.prototype.initializeSimplicialSetEmbedding=function(){for(var r=this,e=this.getNEpochs(),t=this.nComponents,n=this.graph.getValues(),s=0,i=0;i<n.length;i++){var u=n[i];s<n[i]&&(s=u)}var l=this.graph.map(function(v){return v<s/e?0:v});this.embedding=U.zeros(l.nRows).map(function(){return U.zeros(t).map(function(){return U.tauRand(r.random)*20+-10})});for(var a=[],f=[],h=[],c=l.getAll(),i=0;i<c.length;i++){var p=c[i];p.value&&(a.push(p.value),h.push(p.row),f.push(p.col))}var m=this.makeEpochsPerSample(a,e);return{head:f,tail:h,epochsPerSample:m}},o.prototype.makeEpochsPerSample=function(r,e){var t=U.filled(r.length,-1),n=U.max(r),s=r.map(function(i){return i/n*e});return s.forEach(function(i,u){i>0&&(t[u]=e/s[u])}),t},o.prototype.assignOptimizationStateParameters=function(r){Object.assign(this.optimizationState,r)},o.prototype.prepareForOptimizationLoop=function(){var r=this,e=r.repulsionStrength,t=r.learningRate,n=r.negativeSampleRate,s=this.optimizationState,i=s.epochsPerSample,u=s.headEmbedding,l=s.tailEmbedding,a=u[0].length,f=u.length===l.length,h=i.map(function(m){return m/n}),c=_e(h),p=_e(i);this.assignOptimizationStateParameters({epochOfNextSample:p,epochOfNextNegativeSample:c,epochsPerNegativeSample:h,moveOther:f,initialAlpha:t,alpha:t,gamma:e,dim:a})},o.prototype.initializeOptimization=function(){var r=this.embedding,e=this.embedding,t=this.optimizationState,n=t.head,s=t.tail,i=t.epochsPerSample,u=this.getNEpochs(),l=this.graph.nCols,a=Je(this.spread,this.minDist),f=a.a,h=a.b;this.assignOptimizationStateParameters({headEmbedding:r,tailEmbedding:e,head:n,tail:s,epochsPerSample:i,a:f,b:h,nEpochs:u,nVertices:l})},o.prototype.optimizeLayoutStep=function(r){for(var e=this.optimizationState,t=e.head,n=e.tail,s=e.headEmbedding,i=e.tailEmbedding,u=e.epochsPerSample,l=e.epochOfNextSample,a=e.epochOfNextNegativeSample,f=e.epochsPerNegativeSample,h=e.moveOther,c=e.initialAlpha,p=e.alpha,m=e.gamma,v=e.a,y=e.b,g=e.dim,b=e.nEpochs,M=e.nVertices,x=4,E=0;E<u.length;E++)if(!(l[E]>r)){var z=t[E],_=n[E],R=s[z],I=i[_],w=ze(R,I),d=0;w>0&&(d=-2*v*y*Math.pow(w,y-1),d/=v*Math.pow(w,y)+1);for(var j=0;j<g;j++){var S=ke(d*(R[j]-I[j]),x);R[j]+=S*p,h&&(I[j]+=-S*p)}l[E]+=u[E];for(var O=Math.floor((r-a[E])/f[E]),T=0;T<O;T++){var $=U.tauRandInt(M,this.random),q=i[$],B=ze(R,q),Y=0;if(B>0)Y=2*m*y,Y/=(.001+B)*(v*Math.pow(B,y)+1);else if(z===$)continue;for(var j=0;j<g;j++){var S=4;Y>0&&(S=ke(Y*(R[j]-q[j]),x)),R[j]+=S*p}}a[E]+=O*f[E]}return e.alpha=c*(1-r/b),e.currentEpoch+=1,s},o.prototype.optimizeLayoutAsync=function(r){var e=this;return r===void 0&&(r=function(){return!0}),new Promise(function(t,n){var s=function(){return je(e,void 0,void 0,function(){var i,u,l,a,f,h;return xe(this,function(c){try{if(i=this.optimizationState,u=i.nEpochs,l=i.currentEpoch,this.embedding=this.optimizeLayoutStep(l),a=this.optimizationState.currentEpoch,f=r(a)===!1,h=a===u,!f&&!h)setTimeout(function(){return s()},0);else return[2,t(h)]}catch(p){n(p)}return[2]})})};setTimeout(function(){return s()},0)})},o.prototype.optimizeLayout=function(r){r===void 0&&(r=function(){return!0});for(var e=!1,t=[];!e;){var n=this.optimizationState,s=n.nEpochs,i=n.currentEpoch;t=this.optimizeLayoutStep(i);var u=this.optimizationState.currentEpoch,l=r(u)===!1;e=u===s||l}return t},o.prototype.getNEpochs=function(){var r=this.graph;if(this.nEpochs>0)return this.nEpochs;var e=r.nRows;return e<=2500?500:e<=5e3?400:e<=7500?300:200},o}();J.UMAP=qo;function Qe(o,r){for(var e=0,t=0;t<o.length;t++)e+=Math.pow(o[t]-r[t],2);return Math.sqrt(e)}J.euclidean=Qe;function Lo(o,r){for(var e=0,t=0,n=0,s=0;s<o.length;s++)e+=o[s]*r[s],t+=Math.pow(o[s],2),n+=Math.pow(r[s],2);return t===0&&n===0?0:t===0||n===0?1:1-e/Math.sqrt(t*n)}J.cosine=Lo;var Vo=function(){function o(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}return o}();function ke(o,r){return o>r?r:o<-r?-r:o}function ze(o,r){for(var e=0,t=0;t<o.length;t++)e+=Math.pow(o[t]-r[t],2);return e}function Je(o,r){var e=function(c){var p=ne(c,2),m=p[0],v=p[1];return function(y){return 1/(1+m*Math.pow(y,2*v))}},t=U.linear(0,o*3,300).map(function(c){return c<r?1:c}),n=U.zeros(t.length).map(function(c,p){var m=t[p]>=r;return m?Math.exp(-(t[p]-r)/o):c}),s=[.5,.5],i={x:t,y:n},u={damping:1.5,initialValues:s,gradientDifference:.1,maxIterations:100,errorTolerance:.01},l=Co.default(i,e,u).parameterValues,a=ne(l,2),f=a[0],h=a[1];return{a:f,b:h}}J.findABParams=Je;function Ze(o,r,e,t){return e===void 0&&(e=1),t===void 0&&(t=5),o.map(function(n,s,i){return r[s]===-1||r[i]===-1?n*Math.exp(-e):r[s]!==r[i]?n*Math.exp(-t):n})}J.fastIntersection=Ze;function Ae(o){o=V.normalize(o,"max");var r=V.transpose(o),e=V.pairwiseMultiply(r,o);return o=V.add(o,V.subtract(r,e)),V.eliminateZeros(o)}J.resetLocalConnectivity=Ae;function He(o,r,e){for(var t=U.zeros(o.length).map(function(l){return U.zeros(e[0].length)}),n=0;n<o.length;n++)for(var s=0;s<o[0].length;s++)for(var i=0;i<e[0].length;i++){var u=o[n][s];t[n][i]+=r[n][s]*e[u][i]}return t}J.initTransform=He;(function(o){Object.defineProperty(o,"__esModule",{value:!0});var r=J;Object.defineProperty(o,"UMAP",{enumerable:!0,get:function(){return r.UMAP}})})(Ie);var ue={exports:{}};ue.exports;(function(o){(function(r,e,t){function n(l){var a=this,f=u();a.next=function(){var h=2091639*a.s0+a.c*23283064365386963e-26;return a.s0=a.s1,a.s1=a.s2,a.s2=h-(a.c=h|0)},a.c=1,a.s0=f(" "),a.s1=f(" "),a.s2=f(" "),a.s0-=f(l),a.s0<0&&(a.s0+=1),a.s1-=f(l),a.s1<0&&(a.s1+=1),a.s2-=f(l),a.s2<0&&(a.s2+=1),f=null}function s(l,a){return a.c=l.c,a.s0=l.s0,a.s1=l.s1,a.s2=l.s2,a}function i(l,a){var f=new n(l),h=a&&a.state,c=f.next;return c.int32=function(){return f.next()*4294967296|0},c.double=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.quick=c,h&&(typeof h=="object"&&s(h,f),c.state=function(){return s(f,{})}),c}function u(){var l=4022871197,a=function(f){f=String(f);for(var h=0;h<f.length;h++){l+=f.charCodeAt(h);var c=.02519603282416938*l;l=c>>>0,c-=l,c*=l,l=c>>>0,c-=l,l+=c*4294967296}return(l>>>0)*23283064365386963e-26};return a}e&&e.exports?e.exports=i:this.alea=i})(k,o)})(ue);var Bo=ue.exports,ae={exports:{}};ae.exports;(function(o){(function(r,e,t){function n(u){var l=this,a="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},u===(u|0)?l.x=u:a+=u;for(var f=0;f<a.length+64;f++)l.x^=a.charCodeAt(f)|0,l.next()}function s(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l}function i(u,l){var a=new n(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,p=(a.next()>>>0)/4294967296,m=(c+p)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(typeof f=="object"&&s(f,a),h.state=function(){return s(a,{})}),h}e&&e.exports?e.exports=i:this.xor128=i})(k,o)})(ae);var Uo=ae.exports,he={exports:{}};he.exports;(function(o){(function(r,e,t){function n(u){var l=this,a="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,u===(u|0)?l.x=u:a+=u;for(var f=0;f<a.length+64;f++)l.x^=a.charCodeAt(f)|0,f==a.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function s(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l.v=u.v,l.d=u.d,l}function i(u,l){var a=new n(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,p=(a.next()>>>0)/4294967296,m=(c+p)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(typeof f=="object"&&s(f,a),h.state=function(){return s(a,{})}),h}e&&e.exports?e.exports=i:this.xorwow=i})(k,o)})(he);var Wo=he.exports,fe={exports:{}};fe.exports;(function(o){(function(r,e,t){function n(u){var l=this;l.next=function(){var f=l.x,h=l.i,c,p;return c=f[h],c^=c>>>7,p=c^c<<24,c=f[h+1&7],p^=c^c>>>10,c=f[h+3&7],p^=c^c>>>3,c=f[h+4&7],p^=c^c<<7,c=f[h+7&7],c=c^c<<13,p^=c^c<<9,f[h]=p,l.i=h+1&7,p};function a(f,h){var c,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,c=0;c<h.length;++c)p[c&7]=p[c&7]<<15^h.charCodeAt(c)+p[c+1&7]<<13;for(;p.length<8;)p.push(0);for(c=0;c<8&&p[c]===0;++c);for(c==8?p[7]=-1:p[c],f.x=p,f.i=0,c=256;c>0;--c)f.next()}a(l,u)}function s(u,l){return l.x=u.x.slice(),l.i=u.i,l}function i(u,l){u==null&&(u=+new Date);var a=new n(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,p=(a.next()>>>0)/4294967296,m=(c+p)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(f.x&&s(f,a),h.state=function(){return s(a,{})}),h}e&&e.exports?e.exports=i:this.xorshift7=i})(k,o)})(fe);var Go=fe.exports,ce={exports:{}};ce.exports;(function(o){(function(r,e,t){function n(u){var l=this;l.next=function(){var f=l.w,h=l.X,c=l.i,p,m;return l.w=f=f+1640531527|0,m=h[c+34&127],p=h[c=c+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,m=h[c]=m^p,l.i=c,m+(f^f>>>16)|0};function a(f,h){var c,p,m,v,y,g=[],b=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,b=Math.max(b,h.length)),m=0,v=-32;v<b;++v)h&&(p^=h.charCodeAt((v+32)%h.length)),v===0&&(y=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(y=y+1640531527|0,c=g[v&127]^=p+y,m=c==0?m+1:0);for(m>=128&&(g[(h&&h.length||0)&127]=-1),m=127,v=4*128;v>0;--v)p=g[m+34&127],c=g[m=m+1&127],p^=p<<13,c^=c<<17,p^=p>>>15,c^=c>>>12,g[m]=p^c;f.w=y,f.X=g,f.i=m}a(l,u)}function s(u,l){return l.i=u.i,l.w=u.w,l.X=u.X.slice(),l}function i(u,l){u==null&&(u=+new Date);var a=new n(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,p=(a.next()>>>0)/4294967296,m=(c+p)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(f.X&&s(f,a),h.state=function(){return s(a,{})}),h}e&&e.exports?e.exports=i:this.xor4096=i})(k,o)})(ce);var Ko=ce.exports,ge={exports:{}};ge.exports;(function(o){(function(r,e,t){function n(u){var l=this,a="";l.next=function(){var h=l.b,c=l.c,p=l.d,m=l.a;return h=h<<25^h>>>7^c,c=c-p|0,p=p<<24^p>>>8^m,m=m-h|0,l.b=h=h<<20^h>>>12^c,l.c=c=c-p|0,l.d=p<<16^c>>>16^m,l.a=m-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,u===Math.floor(u)?(l.a=u/4294967296|0,l.b=u|0):a+=u;for(var f=0;f<a.length+20;f++)l.b^=a.charCodeAt(f)|0,l.next()}function s(u,l){return l.a=u.a,l.b=u.b,l.c=u.c,l.d=u.d,l}function i(u,l){var a=new n(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,p=(a.next()>>>0)/4294967296,m=(c+p)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(typeof f=="object"&&s(f,a),h.state=function(){return s(a,{})}),h}e&&e.exports?e.exports=i:this.tychei=i})(k,o)})(ge);var Xo=ge.exports,tr={exports:{}};const Yo={},Qo=Object.freeze(Object.defineProperty({__proto__:null,default:Yo},Symbol.toStringTag,{value:"Module"})),Jo=qt(Qo);(function(o){(function(r,e,t){var n=256,s=6,i=52,u="random",l=t.pow(n,s),a=t.pow(2,i),f=a*2,h=n-1,c;function p(x,E,z){var _=[];E=E==!0?{entropy:!0}:E||{};var R=g(y(E.entropy?[x,M(e)]:x??b(),3),_),I=new m(_),w=function(){for(var d=I.g(s),j=l,S=0;d<a;)d=(d+S)*n,j*=n,S=I.g(1);for(;d>=f;)d/=2,j/=2,S>>>=1;return(d+S)/j};return w.int32=function(){return I.g(4)|0},w.quick=function(){return I.g(4)/4294967296},w.double=w,g(M(I.S),e),(E.pass||z||function(d,j,S,O){return O&&(O.S&&v(O,I),d.state=function(){return v(I,{})}),S?(t[u]=d,j):d})(w,R,"global"in E?E.global:this==t,E.state)}function m(x){var E,z=x.length,_=this,R=0,I=_.i=_.j=0,w=_.S=[];for(z||(x=[z++]);R<n;)w[R]=R++;for(R=0;R<n;R++)w[R]=w[I=h&I+x[R%z]+(E=w[R])],w[I]=E;(_.g=function(d){for(var j,S=0,O=_.i,T=_.j,$=_.S;d--;)j=$[O=h&O+1],S=S*n+$[h&($[O]=$[T=h&T+j])+($[T]=j)];return _.i=O,_.j=T,S})(n)}function v(x,E){return E.i=x.i,E.j=x.j,E.S=x.S.slice(),E}function y(x,E){var z=[],_=typeof x,R;if(E&&_=="object")for(R in x)try{z.push(y(x[R],E-1))}catch{}return z.length?z:_=="string"?x:x+"\0"}function g(x,E){for(var z=x+"",_,R=0;R<z.length;)E[h&R]=h&(_^=E[h&R]*19)+z.charCodeAt(R++);return M(E)}function b(){try{var x;return c&&(x=c.randomBytes)?x=x(n):(x=new Uint8Array(n),(r.crypto||r.msCrypto).getRandomValues(x)),M(x)}catch{var E=r.navigator,z=E&&E.plugins;return[+new Date,r,z,r.screen,M(e)]}}function M(x){return String.fromCharCode.apply(0,x)}if(g(t.random(),e),o.exports){o.exports=p;try{c=Jo}catch{}}else t["seed"+u]=p})(typeof self<"u"?self:k,[],Math)})(tr);var Zo=tr.exports,Ao=Bo,Ho=Uo,ts=Wo,es=Go,rs=Ko,ns=Xo,vt=Zo;vt.alea=Ao;vt.xor128=Ho;vt.xorwow=ts;vt.xorshift7=es;vt.xor4096=rs;vt.tychei=ns;var os=vt;const ss=yr(os),H=document.getElementById("canvas"),tt=H.getContext("2d"),jt=document.getElementById("input-field"),ot={},is=()=>{H&&tt&&jt&&(H.width=window.innerWidth,H.height=window.innerHeight,tt.fillStyle="rgba(150,150,150,0.9)",tt.fillRect(0,0,H.width,H.height),tt.font="30px Helvetica",tt.textAlign="center",tt.textBaseline="middle",tt.strokeStyle="rgba(100,100,100,0.9)",tt.lineWidth=1,jt.addEventListener("keydown",o=>{if(o.key!=="Enter")return;const r=jt.value;if(r.replace(/[^a-zA-Z]/g,"").length<=0)return;ot[r]={text:r,x:H.width/2,y:H.height/2};const t=Object.keys(ot).map(n=>ot[n].text).join(`
`);jt.value="",ls(t)}),er())},ls=async o=>{const r=await wr(o);Object.keys(ot).length<2||us(r)},er=()=>{if(!(H&&tt&&jt)||(tt.fillStyle="rgba(150,150,150,0.9)",tt.fillRect(0,0,H.width,H.height),tt.fillStyle="black",!Object.keys(ot)))return;const o=Object.keys(ot);o.forEach(r=>{const e=ot[r];o.forEach(t=>{const n=ot[t];gr(tt,e.x,e.y,n.x,n.y)})}),o.forEach(r=>{const e=ot[r],t=e.text;tt.fillText(t,e.x,e.y),e.xTarget&&e.yTarget&&(e.x=we(e.x,e.xTarget,.1),e.y=we(e.y,e.yTarget,.1))}),window.requestAnimationFrame(er)},us=o=>{const r=o.output,e=r.map(u=>u.embedding),t=ss("hello."),s=new Ie.UMAP({nNeighbors:Math.min(Object.keys(ot).length-1,6),minDist:.1,nComponents:2,random:t,spread:.99}).fit(e);as(s).forEach((u,l)=>{const a=r[l].input;ot[a].xTarget=u[0]*H.width*.8+H.width*.1,ot[a].yTarget=u[1]*H.height*.8+H.height*.1}),console.log(ot)},as=o=>{let r=[0,0],e=[0,0];for(let n=0;n<o.length;n++)for(let s=0;s<2;s++)o[n][s]>r[s]&&(r[s]=o[n][s]),o[n][s]<e[s]&&(e[s]=o[n][s]);return o.map(n=>{const s=(n[0]-e[0])/(r[0]-e[0]),i=(n[1]-e[1])/(r[1]-e[1]);return[s,i]})};is();
